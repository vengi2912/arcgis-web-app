// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Print/Print":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/request esri/lang esri/kernel esri/arcgis/utils esri/SpatialReference dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/html dojo/dom-style dojo/dom-construct dojo/dom-class dojo/promise/all dojo/Deferred jimu/portalUrlUtils dojo/text!./templates/Print.html dojo/text!./templates/PrintResult.html dojo/aspect dojo/query jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/Message jimu/utils jimu/SpatialReference/srUtils dojo/on dijit/popup dijit/form/ValidationTextBox dijit/form/Form dijit/form/Select dijit/form/NumberTextBox dijit/form/Button dijit/form/CheckBox dijit/ProgressBar dijit/form/DropDownButton dijit/TooltipDialog dijit/form/RadioButton dijit/form/SimpleTextarea esri/IdentityManager dojo/store/Memory".split(" "),
function(u,A,D,J,K,v,r,q,h,f,x,m,d,t,l,E,M,L,U,R,W,V,Y,N,g,w,I,F,G,H,e,B,z,c){Y=u([A,D,J],{widgetsInTemplate:!0,templateString:Y,map:null,count:1,results:[],authorText:null,copyrightText:null,copyrightEditable:!0,defaultTitle:null,defaultFormat:null,defaultLayout:null,baseClass:"gis_PrintDijit",pdfIcon:require.toUrl("./widgets/Print/images/pdf.png"),imageIcon:require.toUrl("./widgets/Print/images/image.png"),printTaskURL:null,printTask:null,async:!1,_showSettings:!1,_currentTemplateInfo:null,postCreate:function(){this.inherited(arguments);
this.printTask=new K(this.printTaskURL,{async:this.async});this.printparams=new v;this.printparams.map=this.map;this.shelter=new F({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this.shelter.show();this.titleNode.set("value",this.defaultTitle);this.authorNode.set("value",this.defaultAuthor);this.copyrightNode.set("value",this.defaultCopyright);this.copyrightNode.set("readOnly",!this.copyrightEditable);e.loadResource().then(t.hitch(this,function(){if(e.isValidWkid(this.map.spatialReference.wkid)){this.wkidInput.set("value",
this.map.spatialReference.wkid);var y=e.getSRLabel(this.map.spatialReference.wkid);this.wkidLabel.innerHTML=H.sanitizeHTML(y);this.wkidLabel.title=y}else this.wkidInput.set("value",""),this.wkidLabel.innerHTML="",this.wkidLabel.title="";this.wkidInput.set("invalidMessage",this.nls.invalidWkid);this.wkidInput.validator=function(n){return!n||""===n.trim()||e.isValidWkid(+n)}}));var a=V.setHttpProtocol(this.printTaskURL),k=V.getNewPrintUrl(this.appConfig.portalUrl);this._isNewPrintUrl=a===k||/sharing\/tools\/newPrint$/.test(a);
a=w("input",this.printWidgetMapScale.domNode)[0];k=w("input",this.printWidgetMapExtent.domNode)[0];H.combineRadioCheckBoxWithLabel(a,this.printWidgetMapScaleLabel);H.combineRadioCheckBoxWithLabel(k,this.printWidgetMapExtentLabel);"MAP_ONLY"===this.defaultLayout?E.setStyle(this.titleTr,"display","none"):E.setStyle(this.titleTr,"display","");this._hasLabelLayer()?(E.setStyle(this.labelsFormDijit.domNode,"display",""),E.setStyle(this.labelsTitleNode,"display","")):(E.setStyle(this.labelsFormDijit.domNode,
"display","none"),E.setStyle(this.labelsTitleNode,"display","none"));I.getInstance(this.map,this.map.itemInfo).then(t.hitch(this,function(y){this.layerInfosObj=y;return R([this._getPrintTaskInfo(),this._getLayerTemplatesInfo()]).then(t.hitch(this,function(n){var C=n[0];(n=n[1])&&!n.error?(n=n&&n.results)&&0<n.length&&(l.some(n,t.hitch(this,function(O){return O&&"Output_JSON"===O.paramName?this.templateInfos=O.value:!1})),this.templateInfos&&0<this.templateInfos.length&&(this.templateNames=l.map(this.templateInfos,
function(O){return O.layoutTemplate}))):console.warn("Get Layout Templates Info Error",n&&n.error);!h.isDefined(C)||C&&C.error?this._handleError(C.error):this._handlePrintInfo(C)}))})).always(t.hitch(this,function(){this.shelter.hide()}));this.printTask._getPrintDefinition&&g.after(this.printTask,"_getPrintDefinition",t.hitch(this,"printDefInspector"),!1);this.printTask._createOperationalLayers&&(g.after(this.printTask,"_createOperationalLayers",t.hitch(this,"_fixInvalidSymbol")),g.after(this.printTask,
"_createOperationalLayers",t.hitch(this,"_excludeInvalidLegend")))},_onOutputSRChange:function(a){e.isValidWkid(+a)?(a=e.getSRLabel(+a),this.wkidLabel.innerHTML=H.sanitizeHTML(a),this.wkidLabel.title=a):(this.wkidLabel.innerHTML="",this.wkidLabel.title="")},_hasLabelLayer:function(){return l.some(this.map.graphicsLayerIds,function(a){return(a=this.map.getLayer(a))&&"esri.layers.LabelLayer"===a.declaredClass},this)},_getPrintTaskInfo:function(){var a=new W;this._isNewPrintUrl?a.resolve({isGPPrint:!1}):
q({url:this.printTaskURL,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4}).then(t.hitch(this,function(k){a.resolve({isGPPrint:!0,data:k})}),t.hitch(this,function(k){a.resolve({error:k})}));return a},_getLayerTemplatesInfo:function(){var a=new W,k=this.printTaskURL.split("/"),y=k.indexOf("GPServer");if(-1<y){var n=null;n=/Utilities\/PrintingTools\/GPServer/.test(this.printTaskURL)?k.slice(0,y+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info Task")+"/execute":
k.slice(0,y+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info")+"/execute";q({url:n,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4}).then(t.hitch(this,function(C){a.resolve(C)}),t.hitch(this,function(C){a.resolve({error:C})}))}else a.resolve(null);return a},_fixInvalidSymbol:function(a){l.forEach(a,function(k){"map_graphics"===k.id&&(k=t.getObject("featureCollection.layers",!1,k))&&0<k.length&&l.forEach(k,function(y){y&&y.featureSet&&"esriGeometryPoint"===
y.featureSet.geometryType&&l.forEach(y.featureSet.features,function(n){n&&n.symbol&&!n.symbol.style&&(n.symbol.style="esriSMSSquare")})})},this);return a},_excludeInvalidLegend:function(a){function k(T){return l.filter(T.subLayerIds,t.hitch(this,function(X){return(X=this.layerInfosObj.getLayerInfoById(T.id+"_"+X))&&X.getShowLegendOfWebmap()}))}if(this.printTask.allLayerslegend){var y=x.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo});y=l.map(y,function(T){return{id:T.layer.id}});for(var n=
this.printTask.allLayerslegend,C=[],O=0;O<n.length;O++){var P=n[O],Q=this.map.getLayer(P.id),S=this.layerInfosObj.getLayerInfoById(P.id);Q&&Q.declaredClass&&"esri.layers.GraphicsLayer"!==Q.declaredClass&&(Q=!Q.renderer||Q.renderer&&!Q.renderer.hasVisualVariables(),S=S&&S.getShowLegendOfWebmap(),Q&&S&&(P.subLayerIds&&(P.subLayerIds=t.hitch(this,k,P)()),C.push(P)))}l.forEach(y,t.hitch(this,function(T){var X=l.some(C,t.hitch(this,function(aa){return aa.id===T.id})),Z=this.layerInfosObj.getLayerInfoById(T.id);
Z=Z&&Z.getShowLegendOfWebmap()&&Z.isShowInMap();!X&&Z&&C.push(T)}));this.printTask.allLayerslegend=C}return a},printDefInspector:function(a){"force"===this.preserve.preserveScale&&(a.mapOptions.scale=this.preserve.forcedScale);return a},_handleError:function(a){console.log("print widget load error: ",a);new G({message:a.message||a})},onLayoutChange:function(a){var k=this.templateNames&&this.templateNames.indexOf(a);if(-1<k){E.empty(this.customTextElementsTable);a=this._currentTemplateInfo=this.templateInfos[k];
if((k=t.getObject("layoutOptions.customTextElements",!1,a))&&0<k.length){var y=[];l.forEach(k,t.hitch(this,function(n){for(var C in n)if(0>y.indexOf(C)){var O=this.customTextElementsTable.insertRow(-1);O.insertCell(-1).appendChild(E.toDom(C+": "));O.insertCell(-1).appendChild((new c({name:C,trim:!0,required:!1,value:n[C],style:"width:100%"})).domNode);y.push(C)}}))}t.getObject("layoutOptions.hasAuthorText",!1,a)?E.setStyle(this.authorTr,"display",""):E.setStyle(this.authorTr,"display","none");t.getObject("layoutOptions.hasCopyrightText",
!1,a)?E.setStyle(this.copyrightTr,"display",""):E.setStyle(this.copyrightTr,"display","none");t.getObject("layoutOptions.hasTitleText",!1,a)?E.setStyle(this.titleTr,"display",""):E.setStyle(this.titleTr,"display","none");t.getObject("layoutOptions.hasLegend",!1,a)?E.setStyle(this.legendTr,"display",""):E.setStyle(this.legendTr,"display","none")}else"MAP_ONLY"===a?(E.setStyle(this.authorTr,"display","none"),E.setStyle(this.copyrightTr,"display","none"),E.setStyle(this.titleTr,"display","none"),E.setStyle(this.legendTr,
"display","none"),this._currentTemplateInfo={layoutOptions:{hasTitleText:!1,hasCopyrightText:!1,hasAuthorText:!1,hasLegend:!1}}):(E.setStyle(this.authorTr,"display",""),E.setStyle(this.copyrightTr,"display",""),E.setStyle(this.titleTr,"display",""),E.setStyle(this.legendTr,"display",""),this._currentTemplateInfo={layoutOptions:{hasTitleText:!0,hasCopyrightText:!0,hasAuthorText:!0,hasLegend:!0}})},_getMapAttribution:function(){var a=this.map.attribution;return a&&a.domNode?E.getProp(a.domNode,"textContent"):
""},closeSettings:function(){z.close(this.settingsDialog);this._showSettings=!1},showSettings:function(a){a.preventDefault();a.stopPropagation();this._showSettings?(z.close(this.settingsDialog),this._showSettings=!1):(z.open({popup:this.settingsDialog,around:this.advancedButtonDijit}),this._showSettings=!0)},_handlePrintInfo:function(a){if(a.isGPPrint){a=a.data;M.set(this.layoutDijit.domNode.parentNode.parentNode,"display","");M.set(this.formatDijit.domNode.parentNode.parentNode,"display","");M.set(this.advancedButtonDijit,
"display","");this.own(B(document.body,"click",t.hitch(this,function(n){if(this._showSettings){n=n.target||n.srcElement;var C=this.settingsDialog.domNode;n===C||E.isDescendant(n,C)||(z.close(this.settingsDialog),this._showSettings=!1)}})));var k=l.filter(a.parameters,function(n){return"Layout_Template"===n.name});if(0===k.length)console.log('print service parameters name for templates must be "Layout_Template"');else{var y=l.map(k[0].choiceList,function(n){return{label:n,value:n}});y.sort(function(n,
C){return n.label>C.label?1:C.label>n.label?-1:0});0<y.length?(this.layoutDijit.addOption(y),this.defaultLayout?this.layoutDijit.set("value",this.defaultLayout):this.layoutDijit.set("value",k[0].defaultValue)):this.defaultLayout&&(this.layoutDijit.addOption([{label:this.defaultLayout,value:this.defaultLayout}]),this.layoutDijit.set("value",this.defaultLayout));a=l.filter(a.parameters,function(n){return"Format"===n.name});0===a.length?console.log('print service parameters name for format must be "Format"'):
(k=l.map(a[0].choiceList,function(n){return{label:n,value:n}}),k.sort(function(n,C){return n.label>C.label?1:C.label>n.label?-1:0}),0<k.length?(this.formatDijit.addOption(k),this.defaultFormat?this.formatDijit.set("value",this.defaultFormat):this.formatDijit.set("value",a[0].defaultValue)):this.defaultFormat&&(this.formatDijit.addOption([{label:this.defaultFormat,value:this.defaultFormat}]),this.formatDijit.set("value",this.defaultFormat)))}}else M.set(this.layoutDijit.domNode.parentNode.parentNode,
"display","none"),M.set(this.formatDijit.domNode.parentNode.parentNode,"display","none"),M.set(this.advancedButtonDijit,"display","none")},print:function(){if(this.printSettingsFormDijit.isValid()){var a=this.printSettingsFormDijit.get("value");t.mixin(a,this.layoutMetadataDijit.get("value"));t.mixin(a,this.forceAttributesFormDijit.get("value"));t.mixin(a,this.labelsFormDijit.get("value"));this.preserve=this.preserveFormDijit.get("value");t.mixin(a,this.preserve);this.layoutForm=this.layoutFormDijit.get("value");
var k=this.mapQualityFormDijit.get("value"),y=this.mapOnlyFormDijit.get("value");t.mixin(y,k);var n=this.customTextElementsDijit.get("value");k=[];var C=!1,O=d.locale||"en";for(Q in n){var P={};"Date"===Q&&(C=!0);P[Q]=n[Q];k.push(P)}C||k.push({Date:(new Date).toLocaleString(O)});C=this._currentTemplateInfo;var Q=t.getObject("layoutOptions.hasAuthorText",!1,C);n=t.getObject("layoutOptions.hasCopyrightText",!1,C);C=t.getObject("layoutOptions.hasTitleText",!1,C);O=new r;O.format=a.format;O.layout=a.layout;
O.preserveScale="true"===a.preserveScale||"force"===a.preserveScale;"force"===a.preserveScale&&(O.outScale=0<this.preserve.forcedScale?this.preserve.forcedScale:this.map.getScale());O.forceFeatureAttributes=a.forceFeatureAttributes&&a.forceFeatureAttributes[0];O.label=a.title;O.exportOptions=y;O.showLabels=a.showLabels&&a.showLabels[0];O.layoutOptions={authorText:Q?a.author:"",copyrightText:n?a.copyright||this._getMapAttribution():"",legendLayers:this._getLegendLayers(),titleText:C?a.title:"",customTextElements:k,
scalebarUnit:this.layoutForm.scalebarUnit};this.printparams.template=O;this.printparams.extraParameters={printFlag:!0};this.printparams.outSpatialReference=void 0;y=+this.wkidInput.get("value");e.isValidWkid(y)&&y!==this.map.spatialReference.wkid&&(this.printparams.outSpatialReference=new m(y));y=this.printTask.execute(this.printparams);(new b({count:this.count.toString(),icon:"PDF"===a.format?this.pdfIcon:this.imageIcon,docName:a.title,title:a.title+", "+a.format+", "+a.layout,fileHandle:y,nls:this.nls,
printTaskURL:this.printTaskURL})).placeAt(this.printResultsNode,"last").startup();M.set(this.clearActionBarNode,"display","block");this.count++}else this.printSettingsFormDijit.validate()},_getLegendLayers:function(){var a=t.getObject("layoutOptions.hasLegend",!1,this._currentTemplateInfo),k=0<this.layoutForm.legend.length&&this.layoutForm.legend[0];if(this.printTask&&!this.printTask._createOperationalLayers){var y=[];a&&k&&(a=x.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo}),y=l.map(a,
function(n){return{layerId:n.layer.id}}));return y}return a&&k?null:[]},clearResults:function(){L.empty(this.printResultsNode);M.set(this.clearActionBarNode,"display","none");this.count=1},updateAuthor:function(a){(a=a||"")&&this.authorTB&&this.authorTB.set("value",a)},getCurrentMapScale:function(){this.forceScaleNTB.set("value",this.map.getScale())}});var b=u([A,D,J],{widgetsInTemplate:!0,templateString:N,url:null,postCreate:function(){this.inherited(arguments);this.progressBar.set("label",this.nls.creatingPrint);
this.fileHandle.then(t.hitch(this,"_onPrintComplete"),t.hitch(this,"_onPrintError"))},_onPrintComplete:function(a){a.url?(this.url=a.url,(a=f.id.findCredential(this.printTaskURL))&&a.token&&(this.url=this.url+"?token\x3d"+a.token),E.setStyle(this.progressBar.domNode,"display","none"),E.setStyle(this.successNode,"display","inline-block"),U.add(this.resultNode,"printResultHover")):this._onPrintError(this.nls.printError)},_onPrintError:function(a){console.log(a);E.setStyle(this.progressBar.domNode,"display",
"none");E.setStyle(this.errNode,"display","block");U.add(this.resultNode,"printResultError");E.setAttr(this.domNode,"title",a.details||a.message||"")},_openPrint:function(){null!==this.url&&window.open(this.url)}});return Y})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(u,A,D,J,K,v,r,q,h,f,x,m,d,t,l,E,M,L,U,R,W,V,Y,N){u=u(U,{declaredClass:"esri.tasks.PrintTask",constructor:function(g,w){this.url=g;this.printGp=new M(this.url);this._handler=A.hitch(this,this._handler);w&&w.async&&(this.async=!0);this._colorEvaluator=N("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(g,w,I){if(!this._loadGpServerMetadata)return this._execute(g,w,I);var F=new K(f._dfdCanceller),G=this._url.path,H=G.lastIndexOf("/GPServer/");
0<H&&(G=G.slice(0,H+9));F._pendingDfd=m({url:G,callbackParamName:"callback",content:A.mixin({},this._url.query,{f:"json"})}).then(A.hitch(this,function(e){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===e.executionType;this._cimVersion=e.cimVersion;this._is11xService=!!this._cimVersion;F._pendingDfd=this._execute(g);return F._pendingDfd})).then(A.hitch(this,function(e){this._successHandler([e],null,w,F)})).otherwise(function(e){I&&I(e);F.errback(e)});return F},_handler:function(g,
w,I,F,G){try{if(this.async)"esriJobSucceeded"===g.jobStatus?this.printGp.getResultData(g.jobId,"Output_File",A.hitch(this,function(e){H=e.value;this._successHandler([H],"onComplete",I,G)})):this._errorHandler(Error(g.jobStatus),F,G);else{var H=g[0].value;this._successHandler([H],"onComplete",I,G)}}catch(e){this._errorHandler(e,F,G)}},_execute:function(g,w,I){var F=this._handler,G=this._errorHandler,H=g.template||new L;H.hasOwnProperty("showLabels")||(H.showLabels=!0);var e=H.exportOptions,B;e&&(B=
{outputSize:[e.width,e.height],dpi:e.dpi});e=H.layoutOptions;var z=[];if(e){this.legendAll=!1;e.legendLayers?D.forEach(e.legendLayers,function(S){var T={};T.id=S.layerId;S.subLayerIds&&(T.subLayerIds=S.subLayerIds);z.push(T)}):this.legendAll=!0;if("Miles"===e.scalebarUnit||"Kilometers"===e.scalebarUnit){var c="esriKilometers";var b="esriMiles"}else if("Meters"===e.scalebarUnit||"Feet"===e.scalebarUnit)c="esriMeters",b="esriFeet";var a={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
a={titleText:e.titleText,authorText:e.authorText,copyrightText:e.copyrightText,customTextElements:e.customTextElements,scaleBarOptions:{metricUnit:c,metricLabel:a[c],nonMetricUnit:b,nonMetricLabel:a[b]},legendOptions:{operationalLayers:z}}}c=this._getPrintDefinition(g.map,H);g.outSpatialReference&&(c.mapOptions.spatialReference=g.outSpatialReference.toJson());g.template&&q.isDefined(g.template.showAttribution)&&(c.mapOptions.showAttribution=g.template.showAttribution);A.mixin(c,{exportOptions:B,layoutOptions:a});
this.allLayerslegend&&A.mixin(c.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(c.operationalLayers){B=c.operationalLayers;var k=function(S){return q.fixJson(A.mixin(S,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},y=RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),n=/[\u0600-\u06FF]/,C=function(S){var T=S.text,X=(S=S.font)&&S.family&&S.family.toLowerCase();T&&S&&("arial"===X||"arial unicode ms"===X)&&(S.family=
y.test(T)?"Arial Unicode MS":"Arial","normal"!==S.style&&n.test(T)&&(S.family="Arial Unicode MS"))};for(a=0;a<B.length;a++)if(B[a].featureCollection&&B[a].featureCollection.layers)for(b=0;b<B[a].featureCollection.layers.length;b++){var O=B[a].featureCollection.layers[b];if(O.layerDefinition&&O.layerDefinition.drawingInfo&&O.layerDefinition.drawingInfo.renderer&&O.layerDefinition.drawingInfo.renderer.symbol){var P=O.layerDefinition.drawingInfo.renderer;"esriCLS"===P.symbol.type?P.symbol=k(P.symbol):
"esriTS"===P.symbol.type?C(P.symbol):P.symbol.outline&&"esriCLS"===P.symbol.outline.type&&(P.symbol.outline=k(P.symbol.outline))}if(O.featureSet&&O.featureSet.features)for(e=0;e<O.featureSet.features.length;e++)P=O.featureSet.features[e],P.symbol&&("esriCLS"===P.symbol.type?P.symbol=k(P.symbol):"esriTS"===P.symbol.type?C(P.symbol):P.symbol.outline&&"esriCLS"===P.symbol.outline.type&&(P.symbol.outline=k(P.symbol.outline)))}}H={Web_Map_as_JSON:J.toJson(q.fixJson(c)),Format:H.format,Layout_Template:H.layout};
g.extraParameters&&(H=A.mixin(H,g.extraParameters));var Q=new K(f._dfdCanceller);g=function(S,T){F(S,T,w,I,Q)};c=function(S){G(S,I,Q)};Q._pendingDfd=this.async?this.printGp.submitJob(H,g,null,c):this.printGp.execute(H,g,c);return Q},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",
geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",
features:[]}}},_convertSvgSymbol:function(g){if(!(8>=v("ie")||!g.path&&"image/svg+xml"!==g.contentType)){var w=Y.createSurface(W.create("div"),1024,1024);var I="image/svg+xml"===g.contentType?w.createObject(Y.Image,{src:"data:image/svg+xml;base64,"+g.imageData,width:V.pt2px(g.width),height:V.pt2px(g.height),x:0,y:0}):w.createObject(Y.Path,g.path).setFill(g.color).setStroke(g.outline);"pendingRender"in w&&w._render(!0);var F=w.rawNode.getContext("2d"),G=Math.ceil(I.getBoundingBox().width),H=Math.ceil(I.getBoundingBox().height);
I=F.getImageData(I.getBoundingBox().x,I.getBoundingBox().y,G,H);F.canvas.width=G;F.canvas.height=H;F.putImageData(I,0,0);F=F.canvas.toDataURL("image/png");g={type:"esriPMS",imageData:F.substr(22,F.length),angle:g.angle,contentType:"image/png",height:g.size?g.size:V.px2pt(H),width:g.size?G/H*g.size:V.px2pt(G),xoffset:g.xoffset,yoffset:g.yoffset};w.destroy();return g}},_convertSvgRenderer:function(g){"simple"===g.type&&g.symbol&&(g.symbol.path||"image/svg+xml"===g.symbol.contentType)?g.symbol=this._convertSvgSymbol(g.symbol):
"uniqueValue"===g.type?(g.defaultSymbol&&(g.defaultSymbol.path||"image/svg+xml"===g.defaultSymbol.contentType)&&(g.defaultSymbol=this._convertSvgSymbol(g.defaultSymbol)),g.uniqueValueInfos&&D.forEach(g.uniqueValueInfos,function(w){if(w.symbol.path||"image/svg+xml"===w.symbol.contentType)w.symbol=this._convertSvgSymbol(w.symbol)},this)):"classBreaks"===g.type&&(g.defaultSymbol&&(g.defaultSymbol.path||"image/svg+xml"===g.defaultSymbol.contentType)&&(g.defaultSymbol=this._convertSvgSymbol(g.defaultSymbol)),
g.classBreakInfos&&D.forEach(g.classBreakInfos,function(w){if(w.symbol.path||"image/svg+xml"===w.symbol.contentType)w.symbol=this._convertSvgSymbol(w.symbol)},this))},_createFeatureCollection:function(g,w,I,F){var G=this._createPolygonLayer(),H=this._createPolylineLayer(),e=this._createPointLayer(),B=this._createMultipointLayer(),z=this._createPointLayer();z.layerDefinition.name="textLayer";delete z.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===g.declaredClass||"esri.layers.StreamLayer"===
g.declaredClass)G.layerDefinition.name=H.layerDefinition.name=e.layerDefinition.name=B.layerDefinition.name=A.getObject("arcgisProps.title",!1,g)||g.name||g.id;var c=g.renderer&&"esri.renderer.SimpleRenderer"===g.renderer.declaredClass;if(!g.renderer||g.renderer.valueExpression||A.isFunction(g.renderer.attributeField))delete G.layerDefinition.drawingInfo,delete H.layerDefinition.drawingInfo,delete e.layerDefinition.drawingInfo,delete B.layerDefinition.drawingInfo;else{var b=g.renderer.toJson({useLegacyRotationProperties:!0});
if("temporal"===b.type){b={latestObservationRenderer:b.latestObservationRenderer,trackLinesRenderer:b.trackRenderer,observationAger:b.observationAger,renderer:b.observationRenderer};var a={};g._trackIdField&&(a.trackIdField=g._trackIdField);g._startTimeField&&(a.startTimeField=g._startTimeField);g._endTimeField&&(a.endTimeField=g._endTimeField);G.layerDefinition.drawingInfo=b;G.layerDefinition.timeInfo=a;H.layerDefinition.drawingInfo=b;H.layerDefinition.timeInfo=a;e.layerDefinition.drawingInfo=b;
e.layerDefinition.timeInfo=a;B.layerDefinition.drawingInfo=b;B.layerDefinition.timeInfo=a}else G.layerDefinition.drawingInfo.renderer=b,H.layerDefinition.drawingInfo.renderer=b,e.layerDefinition.drawingInfo.renderer=b,B.layerDefinition.drawingInfo.renderer=b}b=g.fields;b||!g.renderer||g.renderer.valueExpression||A.isFunction(g.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===g.renderer.declaredClass?(b=[{name:g.renderer.attributeField,type:"esriFieldTypeDouble"}],g.renderer.normalizationField&&
b.push({name:g.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===g.renderer.declaredClass&&(b=[{name:g.renderer.attributeField,type:"esriFieldTypeString"}],g.renderer.attributeField2&&b.push({name:g.renderer.attributeField2,type:"esriFieldTypeString"}),g.renderer.attributeField3&&b.push({name:g.renderer.attributeField3,type:"esriFieldTypeString"})));b&&(G.layerDefinition.fields=b,H.layerDefinition.fields=b,e.layerDefinition.fields=b,B.layerDefinition.fields=
b);b=g.graphics;g.isFeatureReductionActive&&g.isFeatureReductionActive()&&(b=g.getSingleGraphics());a=b.length;var k;for(k=0;k<a;k++){var y=b[k];if(!1!==y.visible&&y.geometry){var n=y.toJson();n.symbol&&n.symbol.outline&&n.symbol.outline.color&&n.symbol.outline.color[3]&&!this._is11xService&&(n.symbol.outline.color[3]=255);if(g.renderer&&!n.symbol&&(A.isFunction(g.renderer.attributeField)||g.renderer.valueExpression||this._isFeatureCollectionRequired(g.renderer,g)||"esri.renderer.DotDensityRenderer"===
g.renderer.declaredClass||I)){I=I||g.renderer;var C=null;try{C=I.getSymbol(y)}catch(O){}if(!C)continue;n.symbol=C.toJson();this._isFeatureCollectionRequired(I,g)&&this._applyVisualVariables(n.symbol,{renderer:I,graphic:y,symbol:C,mapResolution:w&&w.getResolutionInMeters(),mapScale:w&&w.getScale()})}n.symbol&&(n.symbol.path||"image/svg+xml"===n.symbol.contentType?n.symbol=this._convertSvgSymbol(n.symbol):n.symbol.text&&delete n.attributes);switch(y.geometry.type){case "polygon":G.featureSet.features.push(n);
break;case "polyline":H.featureSet.features.push(n);break;case "point":n.symbol&&n.symbol.text?z.featureSet.features.push(n):e.featureSet.features.push(n);break;case "multipoint":B.featureSet.features.push(n);break;case "extent":n.geometry=t.fromExtent(y.geometry).toJson(),G.featureSet.features.push(n)}}}w=[];0<G.featureSet.features.length&&w.push(G);0<H.featureSet.features.length&&w.push(H);0<B.featureSet.features.length&&w.push(B);0<e.featureSet.features.length&&w.push(e);0<z.featureSet.features.length&&
w.push(z);if(!w.length)return null;D.forEach(w,function(O){var P=D.every(O.featureSet.features,function(Q){return Q.symbol});if(c||P)F&&F.forceFeatureAttributes||D.forEach(O.featureSet.features,function(Q){delete Q.attributes}),F.forceFeatureAttributes||delete O.layerDefinition.fields;P&&delete O.layerDefinition.drawingInfo});D.forEach(w,function(O){O.layerDefinition.drawingInfo&&O.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(O.layerDefinition.drawingInfo.renderer)},this);return{id:g.id,
opacity:g.opacity,minScale:g.minScale||0,maxScale:g.maxScale||0,featureCollection:{layers:w}}},_getPrintDefinition:function(g,w){var I={operationalLayers:this._createOperationalLayers(g,w)},F=this._vtlExtent||g.extent,G=g.spatialReference;this._vtlExtent=null;g.spatialReference._isWrappable()&&(F=F._normalize(!0),G=F.spatialReference);F={mapOptions:{showAttribution:g.showAttribution,extent:F.toJson(),spatialReference:G.toJson()}};w.preserveScale&&A.mixin(F.mapOptions,{scale:w.outScale||g.getScale()});
g.timeExtent&&A.mixin(F.mapOptions,{time:[g.timeExtent.startTime.getTime(),g.timeExtent.endTime.getTime()]});g={};A.mixin(g,F,I);return g},_createOperationalLayers:function(g,w){var I,F=[],G=0;w.preserveScale&&(G=w.outScale||g.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var H=D.map(g.layerIds,g.getLayer,g);g._mapImageLyr&&H.push(g._mapImageLyr);for(I=0;I<H.length;I++){var e=H[I];if(e.loaded&&e.visible&&(!G||e.isVisibleAtScale(G))){var B=e.declaredClass;var z={id:e.id,
title:A.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0};z=A.mixin(z,this._getUrlAndToken(e));e.getNode()&&R.get(e.getNode(),"data-reference")&&(z._isRefLayer=!0);switch(B){case "esri.layers.ArcGISDynamicMapServiceLayer":var c=[];B=!!e._params.layers;if(e._params.dynamicLayers)B=w.outScale?e._getDynLayerObjs(w.outScale):J.fromJson(e._params.dynamicLayers),D.forEach(B,function(n){c.push({id:n.id,name:n.name,layerDefinition:n});delete n.id;delete n.name;
delete n.maxScale;delete n.minScale}),0===c.length&&(z.visibleLayers=[-1]);else if(e.supportsDynamicLayers){if(B||e.layerDefinitions||e.layerTimeOptions){var b=e.createDynamicLayerInfosFromLayerInfos(),a=null;B&&(a=e.visibleLayers);a=h._getVisibleLayers(b,a);var k=h._getLayersForScale(w.outScale||g.getScale(),b);D.forEach(b,function(n){if(!n.subLayerIds){var C=n.id;-1<D.indexOf(a,C)&&-1<D.indexOf(k,C)&&(n={source:n.source.toJson()},e.layerDefinitions&&e.layerDefinitions[C]&&(n.definitionExpression=
e.layerDefinitions[C]),e.layerTimeOptions&&e.layerTimeOptions[C]&&(n.layerTimeOptions=e.layerTimeOptions[C].toJson()),c.push({id:C,layerDefinition:n}))}});0===c.length&&(z.visibleLayers=[-1])}}else D.forEach(e.layerInfos,function(n){var C={id:n.id,layerDefinition:{}};e.layerDefinitions&&e.layerDefinitions[n.id]&&(C.layerDefinition.definitionExpression=e.layerDefinitions[n.id]);e.layerTimeOptions&&e.layerTimeOptions[n.id]&&(C.layerDefinition.layerTimeOptions=e.layerTimeOptions[n.id].toJson());(C.layerDefinition.definitionExpression||
C.layerDefinition.layerTimeOptions)&&c.push(C)}),B&&(z.visibleLayers=e.visibleLayers.length?e.visibleLayers:[-1]);c.length&&(z.layers=c);F.push(z);this.allLayerslegend&&this.allLayerslegend.push({id:e.id,subLayerIds:e.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":z=A.mixin(z,{url:e.url,bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation});e.mosaicRule&&A.mixin(z,{mosaicRule:e.mosaicRule.toJson()});if(e.renderingRule||e.renderer)this._is11xService?
(e.renderingRule&&(z.renderingRule=e.renderingRule.toJson()),e.renderer&&(z.layerDefinition=z.layerDefinition||{},z.layerDefinition.drawingInfo=z.layerDefinition.drawingInfo||{},z.layerDefinition.drawingInfo.renderer=e.renderer.toJson())):(B=e.getExportImageRenderingRule())&&A.mixin(z,{renderingRule:B.toJson()});F.push(z);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(z=A.mixin(z,{url:e.url,bandIds:e.bandIds,interpolation:e.interpolation}),
e.renderer&&(z.layerDefinition=z.layerDefinition||{},z.layerDefinition.drawingInfo=z.layerDefinition.drawingInfo||{},z.layerDefinition.drawingInfo.renderer=e.renderer.toJson()),F.push(z),this.allLayerslegend&&this.allLayerslegend.push({id:e.id}));break;case "esri.layers.WMSLayer":z=A.mixin(z,{url:e.url,title:e.title,type:"wms",version:e.version,transparentBackground:e.imageTransparency,visibleLayers:e.visibleLayers});F.push(z);this.allLayerslegend&&this.allLayerslegend.push({id:e.id,subLayerIds:e.visibleLayers});
break;case "esri.virtualearth.VETiledLayer":B=e.mapStyle;"roadOnDemand"===B?B="Road":"aerialWithLabelsOnDemand"===B&&(B="Hybrid");z=A.mixin(z,{visibility:e.visible,type:"BingMaps"+B,culture:e.culture,key:e.bingMapsKey});F.push(z);break;case "esri.layers.OpenStreetMapLayer":z=A.mixin(z,{credits:e.copyright,type:"OpenStreetMap",url:d.getAbsoluteUrl(e.tileServers[0])});F.push(z);break;case "esri.layers.WMTSLayer":z=A.mixin(z,{url:e.url,type:"wmts",layer:e._identifier,style:e._style,format:e.format,tileMatrixSet:e._tileMatrixSetId});
F.push(z);break;case "esri.layers.MapImageLayer":B=e.getImages();D.forEach(B,function(n,C){n.visible&&n.href&&(z={id:e.id+"_image"+C,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity*n.opacity,extent:n.extent.toJson()},"data:image/png;base64,"===n.href.substr(0,22)?z.imageData=n.href.substr(22):z.url=n.href,F.push(z))});break;case "esri.layers.VectorTileLayer":delete z.url;delete z.token;if(this._is11xService&&e.currentStyleInfo.serviceUrl&&e.currentStyleInfo.styleUrl&&
(B=r.id&&r.id.findCredential(e.currentStyleInfo.styleUrl),b=r.id&&r.id.findCredential(e.currentStyleInfo.serviceUrl),!B&&!b||"2.1.0"!==this._cimVersion)){z.type="VectorTileLayer";z.styleUrl=e.currentStyleInfo.styleUrl;B&&(z.token=B.token);b&&b.token!==z.token&&(z.additionalTokens=[{url:e.currentStyleInfo.serviceUrl,token:b.token}]);F.push(z);break}z.type="image";B=this._vtlExtent||g.extent.offset(0,0);var y=w.exportOptions&&w.exportOptions.dpi||96;b={format:"png",pixelRatio:y/96};"MAP_ONLY"!==w.layout||
!w.preserveScale||w.outScale&&w.outScale!==g.getScale()||96!==y||!w.exportOptions||w.exportOptions.width%2===g.width%2&&w.exportOptions.height%2===g.height%2||(b.area={x:0,y:0,width:g.width,height:g.height},w.exportOptions.width%2!==g.width%2&&--b.area.width,w.exportOptions.height%2!==g.height%2&&--b.area.height,this._vtlExtent||(y=g.toMap({x:b.area.width,y:b.area.height}),B.update(B.xmin,y.y,y.x,B.ymax,B.spatialReference),this._vtlExtent=B));z.extent=B._normalize(!0).toJson();B=e.takeScreenshot(b);
B.isResolved()?B.then(function(n){"data:image/png;base64,"===n.dataURL.substr(0,22)&&(z.imageData=n.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");z.imageData&&F.push(z);break;case "esri.layers.WebTiledLayer":B=e.url.replace(/\$\{/g,"{");z=A.mixin(z,{type:"WebTiledLayer",urlTemplate:B,credits:e.copyright});e.subDomains&&0<e.subDomains.length&&(z.subDomains=e.subDomains);e._wmtsInfo&&(z.wmtsInfo=e._wmtsInfo);delete z.url;F.push(z);
break;default:if(e.getTileUrl||e.getImageUrl)z=A.mixin(z,{url:e.url}),F.push(z)}}}H=D.map(g.graphicsLayerIds,g.getLayer,g);for(I=0;I<H.length;I++)e=H[I],e.isFeatureReductionActive&&e.isFeatureReductionActive()&&(e.getSingleGraphics().length?H.splice(++I,0,e.getFeatureReductionLayer()):H[I]=e.getFeatureReductionLayer());for(I=0;I<H.length;I++)if(e=H[I],e.loaded&&e.visible&&(!G||e.isVisibleAtScale(G)))switch(B=e.declaredClass,B){case "esri.layers.CSVLayer":if(this._is11xService){z={id:e.id,url:e.url,
title:e.title,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:e.latitudeFieldName,longitudeFieldName:e.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:e.renderer&&e.renderer.toJson()}}};F.push(z);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===B&&!w.showLabels||e.renderer&&"esri.renderer.HeatmapRenderer"===e.renderer.declaredClass)continue;B=null;e.url&&
e.renderer&&("esri.renderer.ScaleDependentRenderer"===e.renderer.declaredClass?"scale"===e.renderer.rangeType?B=e.renderer.getRendererInfoByScale(g.getScale())&&e.renderer.getRendererInfoByScale(g.getScale()).renderer:"zoom"===e.renderer.rangeType&&(B=e.renderer.getRendererInfoByZoom(g.getZoom())&&e.renderer.getRendererInfoByZoom(g.getZoom()).renderer):B=e.renderer);b=B&&"esri.layers.CSVLayer"!==e.declaredClass&&!this._isFeatureCollectionRequired(B,e)&&!B.valueExpression;y=e.isFeatureReductionActive&&
e.isFeatureReductionActive();if(B&&!y&&"esri.renderer.DotDensityRenderer"!==B.declaredClass&&"esri.layers.StreamLayer"!==e.declaredClass&&(this._is11xService||b)&&("esri.renderer.SimpleRenderer"===B.declaredClass||"esri.renderer.TemporalRenderer"===B.declaredClass||null==B.attributeField||A.isString(B.attributeField)&&e._getField(B.attributeField,!0)))if(z={id:e.id,title:A.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0,layerDefinition:{drawingInfo:{renderer:B.toJson({useLegacyRotationProperties:!this._is11xService})}}},
z=A.mixin(z,this._getUrlAndToken(e)),"esri.renderer.TemporalRenderer"===B.declaredClass&&(b=z.layerDefinition.drawingInfo,b.latestObservationRenderer=b.renderer.latestObservationRenderer,b.trackLinesRenderer=b.renderer.trackRenderer,b.observationAger=b.renderer.observationAger,b.renderer=b.renderer.observationRenderer,e._trackIdField&&(z.layerDefinition.timeInfo={trackIdField:e._trackIdField})),this._convertSvgRenderer(z.layerDefinition.drawingInfo.renderer),this._is11xService||1>e.opacity||"esri.renderer.TemporalRenderer"===
B.declaredClass||this._updateLayerOpacity(z))if(e._params.source&&(B=e._params.source.toJson(),A.mixin(z.layerDefinition,{source:B})),e.getDefinitionExpression()&&A.mixin(z.layerDefinition,{definitionExpression:e.getDefinitionExpression()}),2!==e.mode)0<e.getSelectedFeatures().length&&(B=D.map(e.getSelectedFeatures(),function(n){return n.attributes[e.objectIdField]}),0<B.length&&e.getSelectionSymbol()&&A.mixin(z,{selectionObjectIds:B,selectionSymbol:e.getSelectionSymbol().toJson()}));else{B=D.map(e.getSelectedFeatures(),
function(n){return n.attributes[e.objectIdField]});if(0===B.length||!e._params.drawMode)break;A.mixin(z.layerDefinition,{objectIds:B});B=null;e.getSelectionSymbol()&&(B=new l(e.getSelectionSymbol()));A.mixin(z.layerDefinition.drawingInfo,{renderer:B&&B.toJson()})}else z=this._createFeatureCollection(e,g,null,w);else z=B&&(B.valueExpression||this._isFeatureCollectionRequired(B,e)||"esri.renderer.DotDensityRenderer"===B.declaredClass)?this._createFeatureCollection(e,g,B,w):this._createFeatureCollection(e,
g,null,w);if(!z)continue;F.push(z);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":z=this._createFeatureCollection(e,g,null,w);if(!z)continue;F.push(z);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":z={id:e.id,title:A.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||
0,visibility:e.visible,symbolTileSize:e.symbolTileSize,layerDefinition:{drawingInfo:{renderer:e.renderer.toJson({useLegacyRotationProperties:!this._is11xService})}}},z=A.mixin(z,this._getUrlAndToken(e)),e.mosaicRule&&A.mixin(z,{mosaicRule:e.mosaicRule.toJson()}),F.push(z),this.allLayerslegend&&this.allLayerslegend.push({id:e.id})}G&&D.forEach(F,function(n){n.minScale=0;n.maxScale=0});g.graphics&&0<g.graphics.graphics.length&&(z=this._createFeatureCollection(g.graphics,g,null,w))&&F.push(z);g._labels&&
w.showLabels&&(z=this._createFeatureCollection(g._labels,g,null,w))&&F.push(z);D.forEach(F,function(n,C,O){n._isRefLayer&&(delete n._isRefLayer,O.splice(C,1),O.push(n))});return F},_getUrlAndToken:function(g){return{token:g._getToken(),url:g._url?g._url.path:null}},_updateLayerOpacity:function(g){var w=this._colorEvaluator(g);w=D.filter(w,function(H){return A.isArray(H)&&4===H.length});var I=!0;if(w.length){var F=w[0][3],G;for(G=1;G<w.length;G++)if(F!==w[G][3]){I=!1;break}if(I)for(g.opacity=F/255,
G=0;G<w.length;G++)w[G][3]=255}return I},_isFeatureCollectionRequired:function(g,w){if(w&&w.isFeatureReductionActive&&w.isFeatureReductionActive())return!0;var I=!1;if(w=this._getVariable(g,"rotationInfo",!1))I=(I=w.field)&&A.isFunction(I)||w.valueExpression;return g.hasVisualVariables("sizeInfo")||g.hasVisualVariables("colorInfo")||g.hasVisualVariables("opacityInfo")||I},_getVariable:function(g,w,I){if(g)var F=(g=g.getVisualVariablesForType(w,I))&&g[0];return F},_applyVisualVariables:function(g,
w){var I=w.renderer,F=w.graphic,G=w.symbol,H=w.mapResolution,e=w.mapScale,B=G.type;if("textsymbol"!==B&&"shieldlabelsymbol"!==B){var z=this._getVariable(I,"sizeInfo",!1),c=this._getVariable(I,"colorInfo",!1),b=this._getVariable(I,"opacityInfo",!1);w=this._getVariable(I,"rotationInfo",!1);G instanceof E&&(z=this._getVariable(I,"sizeInfo","outline")||z);H=z?I.getSize(F,{sizeInfo:z,shape:"simplemarkersymbol"===B?G.style:null,resolution:H,scale:e}):F.size;null!=H&&("simplemarkersymbol"===B?g.size=V.px2pt(H):
"picturemarkersymbol"===B?(e=G.width/G.height*H,g.width=V.px2pt(e),g.height=V.px2pt(H),0!==G.xoffset&&(g.xoffset=V.px2pt(G.xoffset/G.width*e)),0!==G.yoffset&&(g.yoffset=V.px2pt(G.yoffset/G.height*H))):"simplelinesymbol"===B?g.width=V.px2pt(H):g.outline&&(g.outline.width=V.px2pt(H)));c&&(!(G=I.getColor(F,{colorInfo:c}))||"simplemarkersymbol"!==B&&"simplelinesymbol"!==B&&"simplefillsymbol"!==B||(g.color=x.toJsonColor(G)));b&&(G=I.getOpacity(F,{opacityInfo:b}),null!=G&&g.color&&(g.color[3]=Math.round(255*
G)));w&&(I=I.getRotationAngle(F,{rotationInfo:w}))&&(g.angle=-I)}}});v("extend-esri")&&A.setObject("tasks.PrintTask",u,r);return u})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(u,A,D,J,K,v,r,q,h,f,x,m,d,t,l,E,M,L,U,R,W,V,Y){u=u(m,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(N){this._jobUpdateHandler=A.hitch(this,this._jobUpdateHandler);this._getJobStatus=A.hitch(this,this._getJobStatus);this._getResultDataHandler=
A.hitch(this,this._getResultDataHandler);this._getResultImageHandler=A.hitch(this,this._getResultImageHandler);this._executeHandler=A.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(N){this.updateDelay=N},setProcessSpatialReference:function(N){this.processSpatialReference=N},setOutputSpatialReference:function(N){this._setOutSR(N)},setOutSpatialReference:function(N){this._setOutSR(N)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(N){this.outSpatialReference=this.outputSpatialReference=N},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(N,g,w){for(var I in N){var F=N[I];A.isArray(F)?N[I]=K.toJson(D.map(F,function(G){return this._gpEncode({item:G},!0).item},this)):F instanceof Date&&(N[I]=F.getTime())}return this._encode(N,g,w)},_decode:function(N){var g=N.dataType,
w=new R(N);if(-1!==D.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],g))return w;if("GPLinearUnit"===g)w.value=new E(w.value);else if("GPFeatureRecordSetLayer"===g||"GPRecordSet"===g)w.value=new d(w.value);else if("GPDataFile"===g)w.value=new M(w.value);else if("GPDate"===g)N=w.value,A.isString(N)?w.value=new U({date:N}):w.value=new Date(N);else if("GPRasterData"===g||"GPRasterDataLayer"===g)N=N.value.mapImage,w.value=N?new Y(N):new L(w.value);else if(-1!==g.indexOf("GPMultiValue:")){var I=g.split(":")[1];
N=w.value;w.value=D.map(N,function(F){return this._decode({paramName:"_name",dataType:I,value:F}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+w.dataType),w=null;return w},submitJob:function(N,g,w,I,F){var G=this._getOutSR(),H=F.assembly;N=this._gpEncode(A.mixin({},this._url.query,{f:"json","env:outSR":G?G.wkid||K.toJson(G.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||K.toJson(this.processSpatialReference.toJson()):
null},N),null,H&&H[0]);var e=this._jobUpdateHandler,B=this._errorHandler;return h({url:this._url.path+"/submitJob",content:N,callbackParamName:"callback",load:function(z,c){e(z,c,!1,g,w,F.dfd)},error:function(z){B(z,I,F.dfd)}})},_jobUpdateHandler:function(N,g,w,I,F,G){var H=N.jobId;g=new t(N);this._successHandler([g],"onStatusUpdate",F,w&&G);if(!w)switch(clearTimeout(this._updateTimers[H]),this._updateTimers[H]=null,G&&G.progress(g),N.jobStatus){case t.STATUS_SUBMITTED:case t.STATUS_EXECUTING:case t.STATUS_WAITING:case t.STATUS_NEW:var e=
this._getJobStatus;this._updateTimers[H]=setTimeout(function(){e(H,w,I,F,G)},this.updateDelay);break;default:this._successHandler([g],"onJobComplete",I,G)}},_getJobStatus:function(N,g,w,I,F){var G=this._jobUpdateHandler;h({url:this._url.path+"/jobs/"+N,content:A.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(H,e){G(H,e,g,w,I,F)},error:this._errorHandler})},_getResultDataHandler:function(N,g,w,I,F){try{var G=this._decode(N);this._successHandler([G],"onGetResultDataComplete",
w,F)}catch(H){this._errorHandler(H,I,F)}},getResultData:function(N,g,w,I){var F=this._getResultDataHandler,G=this._errorHandler,H=new J(f._dfdCanceller);H._pendingDfd=h({url:this._url.path+"/jobs/"+N+"/results/"+g,content:A.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(e,B){F(e,B,w,I,H)},error:function(e){G(e,I,H)}});return H},checkJobStatus:function(N,g,w){var I=this._jobUpdateHandler,F=this._errorHandler,G=new J(f._dfdCanceller);G._pendingDfd=
h({url:this._url.path+"/jobs/"+N,content:A.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(H,e){I(H,e,!0,null,g,G)},error:function(H){F(H,w,G)}});return G},cancelJob:function(N,g,w){var I=this._errorHandler,F=new J(f._dfdCanceller);F._pendingDfd=h({url:this._url.path+"/jobs/"+N+"/cancel",content:A.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:A.hitch(this,function(G,H){this._successHandler([G],"onJobCancel",g,F)}),error:function(G){I(G,w,F)}});
return F},execute:function(N,g,w,I){var F=this._getOutSR(),G=I.assembly;N=this._gpEncode(A.mixin({},this._url.query,{f:"json","env:outSR":F?F.wkid||K.toJson(F.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||K.toJson(this.processSpatialReference.toJson()):null},N),null,G&&G[0]);var H=this._executeHandler,e=this._errorHandler;return h({url:this._url.path+"/execute",content:N,callbackParamName:"callback",load:function(B,z){H(B,z,g,w,I.dfd)},error:function(B){e(B,
w,I.dfd)}})},_executeHandler:function(N,g,w,I,F){try{var G=N.results,H,e=N.messages;var B=0;for(H=G.length;B<H;B++)G[B]=this._decode(G[B]);B=0;for(H=e.length;B<H;B++)e[B]=new l(e[B]);this._successHandler([G,e],"onExecuteComplete",w,F)}catch(z){this._errorHandler(z,I,F)}},_getResultImageHandler:function(N,g,w,I,F){try{var G=this._decode(N);this._successHandler([G],"onGetResultImageComplete",w,F)}catch(H){this._errorHandler(H,I,F)}},getResultImage:function(N,g,w,I,F){var G=this._getResultImageHandler,
H=this._errorHandler;w=this._gpEncode(A.mixin({},this._url.query,{f:"json"},w.toJson()));var e=new J(f._dfdCanceller);e._pendingDfd=h({url:this._url.path+"/jobs/"+N+"/results/"+g,content:w,callbackParamName:"callback",load:function(B,z){G(B,z,I,F,e)},error:function(B){H(B,F,e)}});return e},cancelJobStatusUpdates:function(N){clearTimeout(this._updateTimers[N]);this._updateTimers[N]=null},getResultImageLayer:function(N,g,w,I){if(null==g){var F=this._url.path.indexOf("/GPServer/");N=this._url.path.substring(0,
F)+"/MapServer/jobs/"+N}else N=this._url.path+"/jobs/"+N+"/results/"+g;this._url.query&&(N+="?"+r.objectToQuery(this._url.query));g=null==g?new V(N,{imageParameters:w}):new W(N,{imageParameters:w},!0);this.onGetResultImageLayerComplete(g);I&&I(g);return g},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});x._createWrappers(u);
v("extend-esri")&&A.setObject("tasks.Geoprocessor",u,q);return u})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(u,A,D,J,K){u=u(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(v){this.messages=[];A.mixin(this,v);v=this.messages;var r,q=v.length;for(r=0;r<q;r++)v[r]=new K(v[r])},jobId:"",jobStatus:""});A.mixin(u,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});D("extend-esri")&&A.setObject("tasks.JobInfo",u,J);return u})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(K){A.mixin(this,
K)}});A.mixin(u,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});D("extend-esri")&&A.setObject("tasks.GPMessage",u,J);return u})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(K){K&&A.mixin(this,K)},distance:0,units:null,toJson:function(){var K={};this.distance&&(K.distance=this.distance);this.units&&(K.units=this.units);return K}});D("extend-esri")&&A.setObject("tasks.LinearUnit",u,J);return u})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(K){K&&A.mixin(this,K)},url:null,itemID:null,toJson:function(){var K={};this.url&&(K.url=this.url);this.itemID&&(K.itemID=this.itemID);return K}});D("extend-esri")&&A.setObject("tasks.DataFile",u,J);return u})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.RasterData",constructor:function(K){K&&A.mixin(this,K)},url:null,format:null,itemID:null,toJson:function(){var K=
{};this.url&&(K.url=this.url);this.format&&(K.format=this.format);this.itemID&&(K.itemID=this.itemID);return K}});D("extend-esri")&&A.setObject("tasks.RasterData",u,J);return u})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(u,A,D,J,K){u=u(null,{declaredClass:"esri.tasks.Date",constructor:function(v){v&&(v.format&&(this.format=v.format),this.date=D.parse(v.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:D.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});J("extend-esri")&&A.setObject("tasks.Date",u,K);return u})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(K){A.mixin(this,K)}});D("extend-esri")&&A.setObject("tasks.ParameterValue",u,J);return u})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(u,A,D,J,K,v,r){u=u(r,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(q,h){h&&h.imageParameters&&h.imageParameters.extent&&(this.initialExtent=this.fullExtent=h.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=A.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(q,h,f,x){var m=q.spatialReference.wkid;x(this._url.path+"?"+K.objectToQuery(A.mixin(this._params,{f:"image",bbox:D.toJson(q.toJson()),bboxSR:m,imageSR:m,size:h+","+f})))}});J("extend-esri")&&A.setObject("tasks._GPResultImageLayer",u,v);return u})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,
height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});D("extend-esri")&&A.setObject("tasks.PrintTemplate",u,J);return u})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(u,A,D,J,K,v,r,q,h,f,x,m,d){function t(c,b,a,k,y,n,
C,O,P,Q){var S=b.length,T=0;if(Q){var X=Q.l/y;T=Q.i}else X=b[0]/y;for(;n<C;){if(n+X>C){var Z={l:(n+X-C)*y,i:T};X=C-n}T%2||(c.beginPath(),c.arc(a,k,y,n,n+X,O),P&&c.stroke());n+=X;++T;X=b[T%S]/y}return Z}function l(c,b,a,k){var y=0,n=0,C=0;if(k){var O=k.l;C=k.i}else O=b[0];for(;1>n;)n=d.tAtLength(c,O),1==n&&(y=d.computeLength(c),y={l:O-y,i:C}),c=d.splitBezierAtT(c,n),C%2||a.push(c[0]),c=c[1],++C,O=b[C%b.length];return y}function E(c,b,a,k){var y=[b.last.x,b.last.y].concat(a),n=!(c instanceof Array);
a=4===a.length?"quadraticCurveTo":"bezierCurveTo";var C=[];b=l(y,b.canvasDash,C,k);for(k=0;k<C.length;++k)y=C[k],n?(c.moveTo(y[0],y[1]),c[a].apply(c,y.slice(2))):(c.push("moveTo",[y[0],y[1]]),c.push(a,y.slice(2)));return b}function M(c,b,a,k,y,n,C){var O=0,P=0,Q=0,S=d.distance(a,k,y,n),T=0;b=b.canvasDash;var X=a,Z=k,aa=!(c instanceof Array);C?(Q=C.l,T=C.i):Q+=b[0];for(;.01<Math.abs(1-P);){Q>S&&(O={l:Q-S,i:T},Q=S);P=Q/S;C=a+(y-a)*P;var ba=k+(n-k)*P;T++%2||(aa?(c.moveTo(X,Z),c.lineTo(C,ba)):(c.push("moveTo",
[X,Z]),c.push("lineTo",[C,ba])));X=C;Z=ba;Q+=b[T%b.length]}return O}var L=u.canvas={},U=null,R=x.multiplyPoint,W=Math.PI,V=2*W,Y=W/2;m=A.extend;if(K.global.CanvasRenderingContext2D){K=K.doc.createElement("canvas").getContext("2d");var N="function"==typeof K.setLineDash,g="function"==typeof K.fillText}var w={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,
1,3,1,3]};L.Shape=J("dojox.gfx.canvas.Shape",q.Shape,{_render:function(c){c.save();this._renderTransform(c);this._renderClip(c);this._renderShape(c);this._renderFill(c,!0);this._renderStroke(c,!0);c.restore()},_renderClip:function(c){this.canvasClip&&(this.canvasClip.render(c),c.clip())},_renderTransform:function(c){if("canvasTransform"in this){var b=this.canvasTransform;c.translate(b.dx,b.dy);c.rotate(b.angle2);c.scale(b.sx,b.sy);c.rotate(b.angle1)}},_renderShape:function(c){},_renderFill:function(c,
b){if("canvasFill"in this){var a=this.fillStyle;if("canvasFillImage"in this){var k=a.width,y=a.height,n=this.canvasFillImage.width,C=this.canvasFillImage.height,O=Math.min(k==n?1:k/n,y==C?1:y/C),P=(k-O*n)/2,Q=(y-O*C)/2;U.width=k;U.height=y;var S=U.getContext("2d");S.clearRect(0,0,k,y);S.drawImage(this.canvasFillImage,0,0,n,C,P,Q,O*n,O*C);this.canvasFill=c.createPattern(U,"repeat");delete this.canvasFillImage}c.fillStyle=this.canvasFill;b&&("pattern"!==a.type||0===a.x&&0===a.y||c.translate(a.x,a.y),
c.fill())}else c.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(c,b){var a=this.strokeStyle;a?(c.strokeStyle=a.color.toString(),c.lineWidth=a.width,c.lineCap=a.cap,"number"==typeof a.join?(c.lineJoin="miter",c.miterLimit=a.join):c.lineJoin=a.join,this.canvasDash?N?(c.setLineDash(this.canvasDash),b&&c.stroke()):this._renderDashedStroke(c,b):b&&c.stroke()):b||(c.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(c,b){},getEventSource:function(){return null},on:function(){},connect:function(){},
disconnect:function(){},canvasClip:null,setClip:function(c){this.inherited(arguments);var b=c?"width"in c?"rect":"cx"in c?"ellipse":"points"in c?"polyline":"d"in c?"path":null:null;if(c&&!b)return this;this.canvasClip=c?I(b,c):null;this.parent&&this.parent._makeDirty();return this}});var I=function(c,b){switch(c){case "ellipse":return{canvasEllipse:e({shape:b}),render:function(a){return L.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:A.delegate(b,{r:0}),render:function(a){return L.Rect.prototype._renderShape.call(this,
a)}};case "path":return{canvasPath:F(b),render:function(a){this.canvasPath._renderShape(a)}};case "polyline":return{canvasPolyline:b.points,render:function(a){return L.Polyline.prototype._renderShape.call(this,a)}}}return null},F=function(c){var b=new dojox.gfx.canvas.Path;b.canvasPath=[];b._setPath(c.d);return b},G=function(c,b,a){var k=c.prototype[b];c.prototype[b]=a?function(){this.parent&&this.parent._makeDirty();k.apply(this,arguments);a.call(this);return this}:function(){this.parent&&this.parent._makeDirty();
return k.apply(this,arguments)}};G(L.Shape,"setTransform",function(){this.matrix?this.canvasTransform=u.decompose(this.matrix):delete this.canvasTransform});G(L.Shape,"setFill",function(){var c=this.fillStyle;if(c){if("object"==typeof c&&"type"in c){var b=this.surface.rawNode.getContext("2d");switch(c.type){case "linear":case "radial":var a="linear"==c.type?b.createLinearGradient(c.x1,c.y1,c.x2,c.y2):b.createRadialGradient(c.cx,c.cy,0,c.cx,c.cy,c.r);D.forEach(c.colors,function(k){a.addColorStop(k.offset,
u.normalizeColor(k.color).toString())});break;case "pattern":U||(U=document.createElement("canvas")),b=new Image,this.surface.downloadImage(b,c.src),this.canvasFillImage=b}}else a=c.toString();this.canvasFill=a}else delete this.canvasFill});G(L.Shape,"setStroke",function(){var c=this.strokeStyle;if(c){var b=this.strokeStyle.style.toLowerCase();b in w&&(b=w[b]);if(b instanceof Array){this.canvasDash=b=b.slice();var a;for(a=0;a<b.length;++a)b[a]*=c.width;if("butt"!=c.cap){for(a=0;a<b.length;a+=2)b[a]-=
c.width,1>b[a]&&(b[a]=1);for(a=1;a<b.length;a+=2)b[a]+=c.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!N&&!!this.canvasDash});G(L.Shape,"setShape");L.Group=J("dojox.gfx.canvas.Group",L.Shape,{constructor:function(){q.Container._init.call(this)},_render:function(c){c.save();this._renderTransform(c);this._renderClip(c);for(var b=0;b<this.children.length;++b)this.children[b]._render(c);c.restore()},destroy:function(){q.Container.clear.call(this,!0);L.Shape.prototype.destroy.apply(this,
arguments)}});L.Rect=J("dojox.gfx.canvas.Rect",[L.Shape,q.Rect],{_renderShape:function(c){var b=this.shape,a=Math.min(b.r,b.height/2,b.width/2),k=b.x,y=k+b.width,n=b.y;b=n+b.height;var C=k+a,O=y-a,P=n+a,Q=b-a;c.beginPath();c.moveTo(C,n);a?(c.arc(O,P,a,-Y,0,!1),c.arc(O,Q,a,0,Y,!1),c.arc(C,Q,a,Y,W,!1),c.arc(C,P,a,W,W+Y,!1)):(c.lineTo(O,n),c.lineTo(y,Q),c.lineTo(C,b),c.lineTo(k,P));c.closePath()},_renderDashedStroke:function(c,b){var a=this.shape,k=Math.min(a.r,a.height/2,a.width/2),y=a.x,n=y+a.width,
C=a.y,O=C+a.height,P=y+k,Q=n-k,S=C+k,T=O-k;k?(c.beginPath(),a=M(c,this,P,C,Q,C),b&&c.stroke(),a=t(c,this.canvasDash,Q,S,k,-Y,0,!1,b,a),c.beginPath(),a=M(c,this,n,S,n,T,a),b&&c.stroke(),a=t(c,this.canvasDash,Q,T,k,0,Y,!1,b,a),c.beginPath(),a=M(c,this,Q,O,P,O,a),b&&c.stroke(),a=t(c,this.canvasDash,P,T,k,Y,W,!1,b,a),c.beginPath(),a=M(c,this,y,T,y,S,a),b&&c.stroke(),t(c,this.canvasDash,P,S,k,W,W+Y,!1,b,a)):(c.beginPath(),a=M(c,this,P,C,Q,C),a=M(c,this,Q,C,n,T,a),a=M(c,this,n,T,P,O,a),M(c,this,P,O,y,S,
a),b&&c.stroke())}});var H=[];(function(){var c=f.curvePI4;H.push(c.s,c.c1,c.c2,c.e);for(var b=45;360>b;b+=45){var a=x.rotateg(b);H.push(R(a,c.c1),R(a,c.c2),R(a,c.e))}})();var e=function(c){var b=[],a=c.shape,k=x.normalize([x.translate(a.cx,a.cy),x.scale(a.rx,a.ry)]);var y=R(k,H[0]);b.push([y.x,y.y]);for(a=1;a<H.length;a+=3){var n=R(k,H[a]);var C=R(k,H[a+1]);y=R(k,H[a+2]);b.push([n.x,n.y,C.x,C.y,y.x,y.y])}if(c._needsDash){y=[];n=b[0];for(a=1;a<b.length;++a)C=[],l(n.concat(b[a]),c.canvasDash,C),n=
[b[a][4],b[a][5]],y.push(C);c._dashedPoints=y}return b};L.Ellipse=J("dojox.gfx.canvas.Ellipse",[L.Shape,q.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=e(this);return this},setStroke:function(){this.inherited(arguments);N||(this.canvasEllipse=e(this));return this},_renderShape:function(c){var b=this.canvasEllipse,a;c.beginPath();c.moveTo.apply(c,b[0]);for(a=1;a<b.length;++a)c.bezierCurveTo.apply(c,b[a]);c.closePath()},_renderDashedStroke:function(c,b){var a=this._dashedPoints;
c.beginPath();for(var k=0;k<a.length;++k)for(var y=a[k],n=0;n<y.length;++n){var C=y[n];c.moveTo(C[0],C[1]);c.bezierCurveTo(C[2],C[3],C[4],C[5],C[6],C[7])}b&&c.stroke()}});L.Circle=J("dojox.gfx.canvas.Circle",[L.Shape,q.Circle],{_renderShape:function(c){var b=this.shape;c.beginPath();c.arc(b.cx,b.cy,b.r,0,V,1)},_renderDashedStroke:function(c,b){var a=this.shape,k=0,y=this.canvasDash.length;for(i=0;k<V;){var n=this.canvasDash[i%y]/a.r;i%2||(c.beginPath(),c.arc(a.cx,a.cy,a.r,k,k+n,0),b&&c.stroke());
k+=n;++i}}});L.Line=J("dojox.gfx.canvas.Line",[L.Shape,q.Line],{_renderShape:function(c){var b=this.shape;c.beginPath();c.moveTo(b.x1,b.y1);c.lineTo(b.x2,b.y2)},_renderDashedStroke:function(c,b){var a=this.shape;c.beginPath();M(c,this,a.x1,a.y1,a.x2,a.y2);b&&c.stroke()}});L.Polyline=J("dojox.gfx.canvas.Polyline",[L.Shape,q.Polyline],{setShape:function(){this.inherited(arguments);var c=this.shape.points,b=c[0],a;this.bbox=null;this._normalizePoints();if(c.length)if("number"==typeof b)b=c;else for(b=
[],a=0;a<c.length;++a){var k=c[a];b.push(k.x,k.y)}else b=[];this.canvasPolyline=b;return this},_renderShape:function(c){var b=this.canvasPolyline;if(b.length){c.beginPath();c.moveTo(b[0],b[1]);for(var a=2;a<b.length;a+=2)c.lineTo(b[a],b[a+1])}},_renderDashedStroke:function(c,b){var a=this.canvasPolyline,k=0;c.beginPath();for(var y=0;y<a.length;y+=2)k=M(c,this,a[y],a[y+1],a[y+2],a[y+3],k);b&&c.stroke()}});L.Image=J("dojox.gfx.canvas.Image",[L.Shape,q.Image],{setShape:function(){this.inherited(arguments);
var c=new Image;this.surface.downloadImage(c,this.shape.src);this.canvasImage=c;return this},_renderShape:function(c){var b=this.shape;c.drawImage(this.canvasImage,b.x,b.y,b.width,b.height)}});L.Text=J("dojox.gfx.canvas.Text",[L.Shape,q.Text],{_setFont:function(){this.fontStyle?this.canvasFont=u.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var c=this.shape,b=0;if(c.text){var a=this.surface.rawNode.getContext("2d");a.save();this._renderTransform(a);this._renderFill(a,
!1);this._renderStroke(a,!1);this.canvasFont&&(a.font=this.canvasFont);b=a.measureText(c.text).width;a.restore()}return b},_render:function(c){c.save();this._renderTransform(c);this._renderFill(c,!1);this._renderStroke(c,!1);this._renderShape(c);c.restore()},_renderShape:function(c){var b=this.shape;b.text&&(c.textAlign="middle"===b.align?"center":b.align,this.canvasFont&&(c.font=this.canvasFont),this.canvasFill&&c.fillText(b.text,b.x,b.y),this.strokeStyle&&(c.beginPath(),c.strokeText(b.text,b.x,
b.y),c.closePath()))}});G(L.Text,"setFont");g||L.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var B={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};L.Path=J("dojox.gfx.canvas.Path",
[L.Shape,h.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);N||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(c){var b=A.clone(this.last);this[B[c.action]](this.canvasPath,c.action,c.args,this._needsDash?this._dashedPath:null);this.last=b;this.inherited(arguments)},
_renderShape:function(c){var b=this.canvasPath;c.beginPath();for(var a=0;a<b.length;a+=2)c[b[a]].apply(c,b[a+1])},_renderDashedStroke:N?function(){}:function(c,b){var a=this._dashedPath;c.beginPath();for(var k=0;k<a.length;k+=2)c[a[k]].apply(c,a[k+1]);b&&c.stroke()},_moveToA:function(c,b,a,k){c.push("moveTo",[a[0],a[1]]);k&&k.push("moveTo",[a[0],a[1]]);for(b=2;b<a.length;b+=2)c.push("lineTo",[a[b],a[b+1]]),k&&(this._dashResidue=M(k,this,a[b-2],a[b-1],a[b],a[b+1],this._dashResidue));this.last.x=a[a.length-
2];this.last.y=a[a.length-1];this.lastControl={}},_moveToR:function(c,b,a,k){b="x"in this.last?[this.last.x+=a[0],this.last.y+=a[1]]:[this.last.x=a[0],this.last.y=a[1]];c.push("moveTo",b);k&&k.push("moveTo",b);for(b=2;b<a.length;b+=2)c.push("lineTo",[this.last.x+=a[b],this.last.y+=a[b+1]]),k&&(this._dashResidue=M(k,this,k[k.length-1][0],k[k.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(c,b,a,k){for(b=0;b<a.length;b+=2)k&&(this._dashResidue=M(k,this,
this.last.x,this.last.y,a[b],a[b+1],this._dashResidue)),c.push("lineTo",[a[b],a[b+1]]);this.last.x=a[a.length-2];this.last.y=a[a.length-1];this.lastControl={}},_lineToR:function(c,b,a,k){for(b=0;b<a.length;b+=2)c.push("lineTo",[this.last.x+=a[b],this.last.y+=a[b+1]]),k&&(this._dashResidue=M(k,this,k[k.length-1][0],k[k.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(c,b,a,k){for(b=0;b<a.length;++b)c.push("lineTo",[a[b],this.last.y]),k&&(this._dashResidue=
M(k,this,k[k.length-1][0],k[k.length-1][1],a[b],this.last.y,this._dashResidue));this.last.x=a[a.length-1];this.lastControl={}},_hLineToR:function(c,b,a,k){for(b=0;b<a.length;++b)c.push("lineTo",[this.last.x+=a[b],this.last.y]),k&&(this._dashResidue=M(k,this,k[k.length-1][0],k[k.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(c,b,a,k){for(b=0;b<a.length;++b)c.push("lineTo",[this.last.x,a[b]]),k&&(this._dashResidue=M(k,this,k[k.length-1][0],k[k.length-
1][1],this.last.x,a[b],this._dashResidue));this.last.y=a[a.length-1];this.lastControl={}},_vLineToR:function(c,b,a,k){for(b=0;b<a.length;++b)c.push("lineTo",[this.last.x,this.last.y+=a[b]]),k&&(this._dashResidue=M(k,this,k[k.length-1][0],k[k.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(c,b,a,k){for(b=0;b<a.length;b+=6)c.push("bezierCurveTo",a.slice(b,b+6)),k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue));this.last.x=a[a.length-2];
this.last.y=a[a.length-1];this.lastControl.x=a[a.length-4];this.lastControl.y=a[a.length-3];this.lastControl.type="C"},_curveToR:function(c,b,a,k){for(b=0;b<a.length;b+=6)c.push("bezierCurveTo",[this.last.x+a[b],this.last.y+a[b+1],this.lastControl.x=this.last.x+a[b+2],this.lastControl.y=this.last.y+a[b+3],this.last.x+a[b+4],this.last.y+a[b+5]]),k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue)),this.last.x+=a[b+4],this.last.y+=a[b+5];this.lastControl.type="C"},_smoothCurveToA:function(c,
b,a,k){for(b=0;b<a.length;b+=4){var y="C"==this.lastControl.type;c.push("bezierCurveTo",[y?2*this.last.x-this.lastControl.x:this.last.x,y?2*this.last.y-this.lastControl.y:this.last.y,a[b],a[b+1],a[b+2],a[b+3]]);k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue));this.lastControl.x=a[b];this.lastControl.y=a[b+1];this.lastControl.type="C"}this.last.x=a[a.length-2];this.last.y=a[a.length-1]},_smoothCurveToR:function(c,b,a,k){for(b=0;b<a.length;b+=4){var y="C"==this.lastControl.type;c.push("bezierCurveTo",
[y?2*this.last.x-this.lastControl.x:this.last.x,y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+a[b],this.last.y+a[b+1],this.last.x+a[b+2],this.last.y+a[b+3]]);k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue));this.lastControl.x=this.last.x+a[b];this.lastControl.y=this.last.y+a[b+1];this.lastControl.type="C";this.last.x+=a[b+2];this.last.y+=a[b+3]}},_qCurveToA:function(c,b,a,k){for(b=0;b<a.length;b+=4)c.push("quadraticCurveTo",a.slice(b,b+4));k&&(this._dashResidue=E(k,this,
c[c.length-1],this._dashResidue));this.last.x=a[a.length-2];this.last.y=a[a.length-1];this.lastControl.x=a[a.length-4];this.lastControl.y=a[a.length-3];this.lastControl.type="Q"},_qCurveToR:function(c,b,a,k){for(b=0;b<a.length;b+=4)c.push("quadraticCurveTo",[this.lastControl.x=this.last.x+a[b],this.lastControl.y=this.last.y+a[b+1],this.last.x+a[b+2],this.last.y+a[b+3]]),k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue)),this.last.x+=a[b+2],this.last.y+=a[b+3];this.lastControl.type="Q"},
_qSmoothCurveToA:function(c,b,a,k){for(b=0;b<a.length;b+=2){var y="Q"==this.lastControl.type;c.push("quadraticCurveTo",[this.lastControl.x=y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=y?2*this.last.y-this.lastControl.y:this.last.y,a[b],a[b+1]]);k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=a[a.length-2];this.last.y=a[a.length-1]},_qSmoothCurveToR:function(c,b,a,k){for(b=0;b<a.length;b+=2){var y="Q"==this.lastControl.type;
c.push("quadraticCurveTo",[this.lastControl.x=y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+a[b],this.last.y+a[b+1]]);k&&(this._dashResidue=E(k,this,c[c.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=a[b];this.last.y+=a[b+1]}},_arcTo:function(c,b,a,k){b="a"==b;for(var y=0;y<a.length;y+=7){var n=a[y+5],C=a[y+6];b&&(n+=this.last.x,C+=this.last.y);var O=f.arcAsBezier(this.last,a[y],a[y+1],a[y+2],a[y+
3]?1:0,a[y+4]?1:0,n,C);D.forEach(O,function(P){c.push("bezierCurveTo",P)});k&&(this._dashResidue=E(k,this,p,this._dashResidue));this.last.x=n;this.last.y=C}this.lastControl={}},_closePath:function(c,b,a,k){c.push("closePath",[]);k&&(this._dashResidue=M(k,this,this.last.x,this.last.y,k[1][0],k[1][1],this._dashResidue));this.lastControl={}}});D.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(c){G(L.Path,c)});L.TextPath=J("dojox.gfx.canvas.TextPath",
[L.Shape,h.TextPath],{_renderShape:function(c){},_setText:function(){},_setFont:function(){}});L.Surface=J("dojox.gfx.canvas.Surface",q.Surface,{constructor:function(){q.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){q.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(c,b){this.width=u.normalizedLength(c);this.height=u.normalizedLength(b);if(!this.rawNode)return this;c=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,
c=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,c=!0);c&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(c){!this.rawNode||!c&&this.pendingImageCount||(c=this.rawNode.getContext("2d"),c.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(c),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(c){c.save();for(var b=
0;b<this.children.length;++b)this.children[b]._render(c);c.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(A.hitch(this,this._render),0))},downloadImage:function(c,b){var a=A.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);c.onload=a;c.onerror=a;c.onabort=a;c.src=b},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),
this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});L.createSurface=function(c,b,a){if(!b&&!a){var k=v.position(c);b=b||k.w;a=a||k.h}"number"==typeof b&&(b+="px");"number"==typeof a&&(a+="px");k=new L.Surface;c=r.byId(c);var y=c.ownerDocument.createElement("canvas");y.width=u.normalizedLength(b);y.height=u.normalizedLength(a);c.appendChild(y);k.rawNode=y;k._parent=c;return k.surface=k};var z=q.Container;
J={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(c){this._makeDirty();return z.add.apply(this,arguments)},remove:function(c,b){this._makeDirty();return z.remove.apply(this,arguments)},clear:function(){this._makeDirty();return z.clear.apply(this,arguments)},getBoundingBox:z.getBoundingBox,_moveChildToFront:function(c){this._makeDirty();
return z._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(c){this._makeDirty();return z._moveChildToBack.apply(this,arguments)}};h={createObject:function(c,b){c=new c;c.surface=this.surface;c.setShape(b);this.add(c);return c}};m(L.Group,J);m(L.Group,q.Creator);m(L.Group,h);m(L.Surface,J);m(L.Surface,q.Creator);m(L.Surface,h);L.fixTarget=function(c,b){return!0};return L})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(u,A,D,J,K,v,r,q,h,f){function x(d,t){for(var l=d.length-1;t<l;)d[t]=d[++t];d.length=l}var m=u.shape={};m.Shape=D("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(K("gfxRegistry")){var d=m.register(this);this.getUID=function(){return d}}},destroy:function(){K("gfxRegistry")&&m.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var d=this.getBoundingBox();if(!d)return null;var t=this._getRealMatrix();return[f.multiplyPoint(t,d.x,d.y),f.multiplyPoint(t,d.x+d.width,d.y),f.multiplyPoint(t,d.x+
d.width,d.y+d.height),f.multiplyPoint(t,d.x,d.y+d.height)]},getEventSource:function(){return this.rawNode},setClip:function(d){this.clip=d},getClip:function(){return this.clip},setShape:function(d){this.shape=u.makeParameters(this.shape,d);this.bbox=null;return this},setFill:function(d){if(!d)return this.fillStyle=null,this;var t=null;if("object"==typeof d&&"type"in d)switch(d.type){case "linear":t=u.makeParameters(u.defaultLinearGradient,d);break;case "radial":t=u.makeParameters(u.defaultRadialGradient,
d);break;case "pattern":t=u.makeParameters(u.defaultPattern,d)}else t=u.normalizeColor(d);this.fillStyle=t;return this},setStroke:function(d){if(!d)return this.strokeStyle=null,this;if("string"==typeof d||A.isArray(d)||d instanceof h)d={color:d};d=this.strokeStyle=u.makeParameters(u.defaultStroke,d);d.color=u.normalizeColor(d.color);return this},setTransform:function(d){this.matrix=f.clone(d?f.normalize(d):f.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var d=
this.getParent();d&&(d._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var d=this.getParent();d&&(d._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(d){return d?this.setTransform([this.matrix,d]):this},applyLeftTransform:function(d){return d?this.setTransform([d,this.matrix]):this},applyTransform:function(d){return d?this.setTransform([this.matrix,d]):this},removeShape:function(d){this.parent&&
this.parent.remove(this,d);return this},_setParent:function(d,t){this.parent=d;return this._updateParentMatrix(t)},_updateParentMatrix:function(d){this.parentMatrix=d?f.clone(d):null;return this._applyTransform()},_getRealMatrix:function(){for(var d=this.matrix,t=this.parent;t;)t.matrix&&(d=f.multiply(t.matrix,d)),t=t.parent;return d}});m._eventsProcessing={on:function(d,t){return v(this.getEventSource(),d,m.fixCallback(this,u.fixTarget,t))},connect:function(d,t,l){"on"==d.substring(0,2)&&(d=d.substring(2));
return this.on(d,l?A.hitch(t,l):t)},disconnect:function(d){return d.remove()}};m.fixCallback=function(d,t,l,E){E||(E=l,l=null);if(A.isString(E)){l=l||J.global;if(!l[E])throw['dojox.gfx.shape.fixCallback: scope["',E,'"] is null (scope\x3d"',l,'")'].join("");return function(M){return t(M,d)?l[E].apply(l,arguments||[]):void 0}}return l?function(M){return t(M,d)?E.apply(l,arguments||[]):void 0}:function(M){return t(M,d)?E.apply(l,arguments):void 0}};A.extend(m.Shape,m._eventsProcessing);m.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(d){var t=d.getParent();t&&t.remove(d,!0);this.children.push(d);return d._setParent(this,this._getRealMatrix())},remove:function(d,t){for(var l=0;l<this.children.length;++l)if(this.children[l]==d){t||(d.parent=null,d.parentMatrix=null);x(this.children,l);break}return this},clear:function(d){for(var t,l=0;l<this.children.length;++l)t=this.children[l],t.parent=null,t.parentMatrix=null,d&&t.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var d=null;r.forEach(this.children,function(t){var l=t.getBoundingBox();l&&((t=t.getTransform())&&(l=f.multiplyRectangle(t,l)),d?(d.x=Math.min(d.x,l.x),d.y=Math.min(d.y,l.y),d.endX=Math.max(d.endX,l.x+l.width),d.endY=Math.max(d.endY,l.y+l.height)):d={x:l.x,y:l.y,endX:l.x+l.width,endY:l.y+l.height})});d&&(d.width=d.endX-d.x,d.height=d.endY-d.y);return d}return null},_moveChildToFront:function(d){for(var t=0;t<this.children.length;++t)if(this.children[t]==
d){x(this.children,t);this.children.push(d);break}return this},_moveChildToBack:function(d){for(var t=0;t<this.children.length;++t)if(this.children[t]==d){x(this.children,t);this.children.unshift(d);break}return this}};m.Surface=D("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){r.forEach(this._nodes,q.destroy);this._nodes=[];r.forEach(this._events,function(d){d&&d.remove()});this._events=[];this.rawNode=null;
if(K("ie"))for(;this._parent.lastChild;)q.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(d){},whenLoaded:function(d,t){var l=A.hitch(d,t);if(this.isLoaded)l(this);else v.once(this,"load",function(E){l(E)})}});A.extend(m.Surface,m._eventsProcessing);m.Rect=D("dojox.gfx.shape.Rect",m.Shape,{constructor:function(d){this.shape=u.getDefault("Rect");this.rawNode=
d},getBoundingBox:function(){return this.shape}});m.Ellipse=D("dojox.gfx.shape.Ellipse",m.Shape,{constructor:function(d){this.shape=u.getDefault("Ellipse");this.rawNode=d},getBoundingBox:function(){if(!this.bbox){var d=this.shape;this.bbox={x:d.cx-d.rx,y:d.cy-d.ry,width:2*d.rx,height:2*d.ry}}return this.bbox}});m.Circle=D("dojox.gfx.shape.Circle",m.Shape,{constructor:function(d){this.shape=u.getDefault("Circle");this.rawNode=d},getBoundingBox:function(){if(!this.bbox){var d=this.shape;this.bbox={x:d.cx-
d.r,y:d.cy-d.r,width:2*d.r,height:2*d.r}}return this.bbox}});m.Line=D("dojox.gfx.shape.Line",m.Shape,{constructor:function(d){this.shape=u.getDefault("Line");this.rawNode=d},getBoundingBox:function(){if(!this.bbox){var d=this.shape;this.bbox={x:Math.min(d.x1,d.x2),y:Math.min(d.y1,d.y2),width:Math.abs(d.x2-d.x1),height:Math.abs(d.y2-d.y1)}}return this.bbox}});m.Polyline=D("dojox.gfx.shape.Polyline",m.Shape,{constructor:function(d){this.shape=u.getDefault("Polyline");this.rawNode=d},setShape:function(d,
t){d&&d instanceof Array?(this.inherited(arguments,[{points:d}]),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[d]);return this},_normalizePoints:function(){var d=this.shape.points,t=d&&d.length;if(t&&"number"==typeof d[0]){for(var l=[],E=0;E<t;E+=2)l.push({x:d[E],y:d[E+1]});this.shape.points=l}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var d=this.shape.points,t=d.length,l=d[0],E=l.x,M=l.y,L=l.x,U=l.y,R=1;R<t;++R)l=
d[R],E>l.x&&(E=l.x),L<l.x&&(L=l.x),M>l.y&&(M=l.y),U<l.y&&(U=l.y);this.bbox={x:E,y:M,width:L-E,height:U-M}}return this.bbox}});m.Image=D("dojox.gfx.shape.Image",m.Shape,{constructor:function(d){this.shape=u.getDefault("Image");this.rawNode=d},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});m.Text=D(m.Shape,{constructor:function(d){this.fontStyle=null;this.shape=u.getDefault("Text");this.rawNode=d},getFont:function(){return this.fontStyle},
setFont:function(d){this.fontStyle="string"==typeof d?u.splitFontString(d):u.makeParameters(u.defaultFont,d);this._setFont();return this},getBoundingBox:function(){var d=null;this.getShape().text&&(d=u._base._computeTextBoundingBox(this));return d}});m.Creator={createShape:function(d){switch(d.type){case u.defaultPath.type:return this.createPath(d);case u.defaultRect.type:return this.createRect(d);case u.defaultCircle.type:return this.createCircle(d);case u.defaultEllipse.type:return this.createEllipse(d);
case u.defaultLine.type:return this.createLine(d);case u.defaultPolyline.type:return this.createPolyline(d);case u.defaultImage.type:return this.createImage(d);case u.defaultText.type:return this.createText(d);case u.defaultTextPath.type:return this.createTextPath(d)}return null},createGroup:function(){return this.createObject(u.Group)},createRect:function(d){return this.createObject(u.Rect,d)},createEllipse:function(d){return this.createObject(u.Ellipse,d)},createCircle:function(d){return this.createObject(u.Circle,
d)},createLine:function(d){return this.createObject(u.Line,d)},createPolyline:function(d){return this.createObject(u.Polyline,d)},createImage:function(d){return this.createObject(u.Image,d)},createText:function(d){return this.createObject(u.Text,d)},createPath:function(d){return this.createObject(u.Path,d)},createTextPath:function(d){return this.createObject(u.TextPath,{}).setText(d)},createObject:function(d,t){return null}};return m})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(u,A,D,J,K){K=D("dojox.gfx.path.Path",K.Shape,{constructor:function(v){this.shape=A.clone(u.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=v;this.segmented=!1},setAbsoluteMode:function(v){this._confirmSegmented();this.absolute="string"==typeof v?"absolute"==v:v;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var v=this.bbox,r=this._getRealMatrix();this.bbox=null;for(var q=0,h=this.segments.length;q<h;++q)this._updateWithSegment(this.segments[q],r);r=this.bbox;this.bbox=v;return this.tbbox=r?[{x:r.l,y:r.t},{x:r.r,y:r.t},{x:r.r,y:r.b},{x:r.l,y:r.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(v,r,q){q&&(r=J.multiplyPoint(q,v,r),v=r.x,r=r.y);this.bbox&&"l"in this.bbox?(this.bbox.l>v&&(this.bbox.l=v),this.bbox.r<v&&(this.bbox.r=v),this.bbox.t>r&&(this.bbox.t=r),this.bbox.b<r&&(this.bbox.b=r)):this.bbox={l:v,b:r,r:v,t:r}},_updateWithSegment:function(v,r){var q=v.args,h=q.length,f;switch(v.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(f=0;f<h;f+=2)this._updateBBox(q[f],
q[f+1],r);this.last.x=q[h-2];this.last.y=q[h-1];this.absolute=!0;break;case "H":for(f=0;f<h;++f)this._updateBBox(q[f],this.last.y,r);this.last.x=q[h-1];this.absolute=!0;break;case "V":for(f=0;f<h;++f)this._updateBBox(this.last.x,q[f],r);this.last.y=q[h-1];this.absolute=!0;break;case "m":f=0;"x"in this.last||(this._updateBBox(this.last.x=q[0],this.last.y=q[1],r),f=2);for(;f<h;f+=2)this._updateBBox(this.last.x+=q[f],this.last.y+=q[f+1],r);this.absolute=!1;break;case "l":case "t":for(f=0;f<h;f+=2)this._updateBBox(this.last.x+=
q[f],this.last.y+=q[f+1],r);this.absolute=!1;break;case "h":for(f=0;f<h;++f)this._updateBBox(this.last.x+=q[f],this.last.y,r);this.absolute=!1;break;case "v":for(f=0;f<h;++f)this._updateBBox(this.last.x,this.last.y+=q[f],r);this.absolute=!1;break;case "c":for(f=0;f<h;f+=6)this._updateBBox(this.last.x+q[f],this.last.y+q[f+1],r),this._updateBBox(this.last.x+q[f+2],this.last.y+q[f+3],r),this._updateBBox(this.last.x+=q[f+4],this.last.y+=q[f+5],r);this.absolute=!1;break;case "s":case "q":for(f=0;f<h;f+=
4)this._updateBBox(this.last.x+q[f],this.last.y+q[f+1],r),this._updateBBox(this.last.x+=q[f+2],this.last.y+=q[f+3],r);this.absolute=!1;break;case "A":for(f=0;f<h;f+=7)this._updateBBox(q[f+5],q[f+6],r);this.last.x=q[h-2];this.last.y=q[h-1];this.absolute=!0;break;case "a":for(f=0;f<h;f+=7)this._updateBBox(this.last.x+=q[f+5],this.last.y+=q[f+6],r);this.absolute=!1}v=[v.action];for(f=0;f<h;++f)v.push(u.formatNumber(q[f],!0));if("string"==typeof this.shape.path)this.shape.path+=v.join("");else for(f=
0,h=v.length;f<h;++f)this.shape.path.push(v[f])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(v,r){this.tbbox=null;var q=this._validSegments[v.toLowerCase()];"number"==typeof q&&(q?r.length>=q&&(v={action:v,args:r.slice(0,r.length-r.length%q)},this.segments.push(v),this._updateWithSegment(v)):(v={action:v,args:[]},this.segments.push(v),this._updateWithSegment(v)))},_collectArgs:function(v,r){for(var q=0;q<r.length;++q){var h=r[q];"boolean"==typeof h?v.push(h?1:0):
"number"==typeof h?v.push(h):h instanceof Array?this._collectArgs(v,h):"x"in h&&"y"in h&&v.push(h.x,h.y)}},moveTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"M":"m",v);return this},lineTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"L":"l",v);return this},hLineTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?
"H":"h",v);return this},vLineTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"V":"v",v);return this},curveTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"C":"c",v);return this},smoothCurveTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"S":"s",v);return this},qCurveTo:function(){this._confirmSegmented();var v=
[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"Q":"q",v);return this},qSmoothCurveTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"T":"t",v);return this},arcTo:function(){this._confirmSegmented();var v=[];this._collectArgs(v,arguments);this._pushSegment(this.absolute?"A":"a",v);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var v=
this.shape.path;this.shape.path=[];this._setPath(v);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(v){v=A.isArray(v)?v:v.match(u.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(v){for(var r="",q=[],h=v.length,f=0;f<h;++f){var x=v[f],m=parseFloat(x);isNaN(m)?(r&&this._pushSegment(r,q),q=[],r=x):q.push(m)}this._pushSegment(r,q)}},setShape:function(v){this.inherited(arguments,["string"==typeof v?{path:v}:v]);this.segmented=!1;this.segments=
[];u.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});D=D("dojox.gfx.path.TextPath",K,{constructor:function(v){"text"in this||(this.text=A.clone(u.defaultTextPath));"fontStyle"in this||(this.fontStyle=A.clone(u.defaultFont))},getText:function(){return this.text},setText:function(v){this.text=u.makeParameters(this.text,"string"==typeof v?{text:v}:v);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(v){this.fontStyle="string"==typeof v?
u.splitFontString(v):u.makeParameters(u.defaultFont,v);this._setFont();return this}});return u.path={Path:K,TextPath:D}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(u,A,D){function J(f){var x=Math.cos(f);f=Math.sin(f);var m={x:x+4/3*(1-x),y:f-4/3*x*(1-x)/f};return{s:{x:x,y:-f},c1:{x:m.x,y:-m.y},c2:m,e:{x:x,y:f}}}var K=2*Math.PI,v=Math.PI/4,r=Math.PI/8,q=v+r,h=J(r);return u.arc={unitArcAsBezier:J,curvePI4:h,arcAsBezier:function(f,x,m,d,t,l,E,M){t=!!t;l=!!l;
var L=D._degToRad(d);d=x*x;var U=m*m,R=D.multiplyPoint(D.rotate(-L),{x:(f.x-E)/2,y:(f.y-M)/2}),W=R.x*R.x,V=R.y*R.y;d=Math.sqrt((d*U-d*V-U*W)/(d*V+U*W));isNaN(d)&&(d=0);d={x:d*x*R.y/m,y:-d*m*R.x/x};t==l&&(d={x:-d.x,y:-d.y});d=D.multiplyPoint([D.translate((f.x+E)/2,(f.y+M)/2),D.rotate(L)],d);x=D.normalize([D.translate(d.x,d.y),D.rotate(L),D.scale(x,m)]);d=D.invert(x);f=D.multiplyPoint(d,f);M=D.multiplyPoint(d,E,M);E=Math.atan2(f.y,f.x);d=E-Math.atan2(M.y,M.x);l&&(d=-d);0>d?d+=K:d>K&&(d-=K);m=r;M=h;
m=l?m:-m;f=[];for(t=d;0<t;t-=v)t<q&&(m=t/2,M=J(m),m=l?m:-m,t=0),R=D.normalize([x,D.rotate(E+m)]),l?(d=D.multiplyPoint(R,M.c1),L=D.multiplyPoint(R,M.c2),R=D.multiplyPoint(R,M.e)):(d=D.multiplyPoint(R,M.c2),L=D.multiplyPoint(R,M.c1),R=D.multiplyPoint(R,M.s)),f.push([d.x,d.y,L.x,L.y,R.x,R.y]),E+=2*m;return f}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(u,A,D){function J(h,f){return Math.abs(h-f)<=1E-6*(Math.abs(h)+Math.abs(f))}function K(h,f,x,m){if(!isFinite(h))return x;
if(!isFinite(x))return h;f=Math.abs(f);m=Math.abs(m);return(f*h+m*x)/(f+m)}function v(h){h=D.normalize(h);var f=-h.xx-h.yy,x=h.xx*h.yy-h.xy*h.yx,m=Math.sqrt(f*f-4*x);f=-(f+(0>f?-m:m))/2;x/=f;m=h.xy/(f-h.xx);var d=1,t=h.xy/(x-h.xx),l=1;J(f,x)&&(m=1,t=d=0,l=1);isFinite(m)||(m=1,d=(f-h.xx)/h.xy,isFinite(d)||(m=(f-h.yy)/h.yx,d=1,isFinite(m)||(m=1,d=h.yx/(f-h.yy))));isFinite(t)||(t=1,l=(x-h.xx)/h.xy,isFinite(l)||(t=(x-h.yy)/h.yx,l=1,isFinite(t)||(t=1,l=h.yx/(x-h.yy))));h=Math.sqrt(m*m+d*d);var E=Math.sqrt(t*
t+l*l);isFinite(m/=h)||(m=0);isFinite(d/=h)||(d=0);isFinite(t/=E)||(t=0);isFinite(l/=E)||(l=0);return{value1:f,value2:x,vector1:{x:m,y:d},vector2:{x:t,y:l}}}function r(h,f){var x=0>h.xx*h.yy||0<h.xy*h.yx?-1:1,m=f.angle1=(Math.atan2(h.yx,h.yy)+Math.atan2(-x*h.xy,x*h.xx))/2;x=Math.cos(m);m=Math.sin(m);f.sx=K(h.xx/x,x,-h.xy/m,m);f.sy=K(h.yy/x,x,h.yx/m,m);return f}function q(h,f){var x=0>h.xx*h.yy||0<h.xy*h.yx?-1:1,m=f.angle2=(Math.atan2(x*h.yx,x*h.xx)+Math.atan2(-h.xy,h.yy))/2;x=Math.cos(m);m=Math.sin(m);
f.sx=K(h.xx/x,x,h.yx/m,m);f.sy=K(h.yy/x,x,-h.xy/m,m);return f}return u.decompose=function(h){var f=D.normalize(h);h={dx:f.dx,dy:f.dy,sx:1,sy:1,angle1:0,angle2:0};if(J(f.xy,0)&&J(f.yx,0))return A.mixin(h,{sx:f.xx,sy:f.yy});if(J(f.xx*f.yx,-f.xy*f.yy))return r(f,h);if(J(f.xx*f.xy,-f.yx*f.yy))return q(f,h);var x=new D.Matrix2D(f);var m=A.mixin(x,{dx:0,dy:0,xy:x.yx,yx:x.xy});x=v([f,m]);m=v([m,f]);x=new D.Matrix2D({xx:x.vector1.x,xy:x.vector2.x,yx:x.vector1.y,yy:x.vector2.y});m=new D.Matrix2D({xx:m.vector1.x,
xy:m.vector1.y,yx:m.vector2.x,yy:m.vector2.y});f=new D.Matrix2D([D.invert(x),f,D.invert(m)]);r(m,h);f.xx*=h.sx;f.yy*=h.sy;q(x,h);f.xx*=h.sx;f.yy*=h.sy;return A.mixin(h,{sx:f.xx,sy:f.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(u){u=u.bezierutils={};u.tAtLength=function(r,q){var h=0,f=6==r.length,x=0,m=0,d=f?J:v,t=function(l,E){for(var M=0,L=0;L<l.length-2;L+=2)M+=D(l[L],l[L+1],l[L+2],l[L+3]);L=f?D(r[0],r[1],r[4],r[5]):D(r[0],r[1],r[6],r[7]);M-L>E||x+M>q+E?(++m,l=d(l,.5),
t(l[0],E),Math.abs(x-q)<=E||t(l[1],E)):(x+=M,h+=1/(1<<m))};q&&t(r,.5);return h};var A=u.computeLength=function(r){for(var q=6==r.length,h=0,f=0;f<r.length-2;f+=2)h+=D(r[f],r[f+1],r[f+2],r[f+3]);f=q?D(r[0],r[1],r[4],r[5]):D(r[0],r[1],r[6],r[7]);return.1<h-f?(r=q?J(r,.5):K(r,.5),h=A(r[0],q),h+=A(r[1],q)):h},D=u.distance=function(r,q,h,f){return Math.sqrt((h-r)*(h-r)+(f-q)*(f-q))},J=function(r,q){var h=1-q,f=h*h,x=q*q,m=r[0],d=r[1],t=r[2],l=r[3],E=r[4];r=r[5];var M=f*m+2*h*q*t+x*E;f=f*d+2*h*q*l+x*r;
return[[m,d,h*m+q*t,h*d+q*l,M,f],[M,f,h*t+q*E,h*l+q*r,E,r]]},K=function(r,q){var h=1-q,f=h*h,x=f*h,m=q*q,d=m*q,t=r[0],l=r[1],E=r[2],M=r[3],L=r[4],U=r[5],R=r[6];r=r[7];var W=x*t+3*f*q*E+3*h*m*L+d*R;x=x*l+3*f*q*M+3*h*m*U+d*r;return[[t,l,h*t+q*E,h*l+q*M,f*t+2*h*q*E+m*L,f*l+2*h*q*M+m*U,W,x],[W,x,f*E+2*h*q*L+m*R,f*M+2*h*q*U+m*r,h*L+q*R,h*U+q*r,R,r]]},v=u.splitBezierAtT=function(r,q){return 6==r.length?J(r,q):K(r,q)};return u})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(u,A,D){A.getObject("json",!0,D);D.json._slice=function(J,K,v,r){var q=J.length,h=[];v=v||q;K=0>K?Math.max(0,K+q):Math.min(q,K);for(v=0>v?Math.max(0,v+q):Math.min(q,v);K<v;K+=r)h.push(J[K]);return h};D.json._find=function(J,K){function v(h){K&&(!0!==K||h instanceof Array?h[K]&&r.push(h[K]):r.push(h));for(var f in h){var x=h[f];K?x&&"object"==typeof x&&v(x):r.push(x)}}var r=[];if(K instanceof Array){if(1==K.length)return J[K[0]];for(var q=0;q<K.length;q++)r.push(J[K[q]])}else v(J);
return r};D.json._distinctFilter=function(J,K){for(var v=[],r={},q=0,h=J.length;q<h;++q){var f=J[q];K(f,q,J)&&("object"==typeof f&&f?f.__included||(f.__included=!0,v.push(f)):r[f+typeof f]||(r[f+typeof f]=!0,v.push(f)))}q=0;for(h=v.length;q<h;++q)v[q]&&delete v[q].__included;return v};return D.json.query=function(J,K){function v(m,d,t,l,E,M,L,U){return q[U].match(/[\*\?]/)||"~"==L?"/^"+q[U].substring(1,q[U].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==L?"$/i":"$/")+".test("+d+")":m}var r=0,q=[];J=J.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(m){r+="["==m?1:"]"==m?-1:0;return"]"==m&&0<r?"`]":'"'==m.charAt(0)||"'"==m.charAt(0)?"`"+(q.push(m)-1):m});var h="";J.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});J=J.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(m){return"."==m.charAt(0)?m:"@"==m?"$obj":(m.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+m}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(m,d,t){return(d=m.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(t="",m.match(/^\./)&&(h="dojox.json._find("+h,t=",true)"),h=(d[1].match(/=/)?"dojo.map":d[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+h,t+",function($obj){return "+d[2]+"})"):(d=m.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+d[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(l,E,M){return"var av\x3d "+M.replace(/\$obj/,
"a")+",bv\x3d "+M.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==E?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==E?-1:1)+";}\n"})+"return 0;})":(d=m.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(h="dojox.json._slice("+h,","+(d[1]||0)+","+(d[2]||0)+","+(d[3]||1)+")"):m.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(h="dojox.json._find("+h,("."==m.charAt(1)?",'"+t+"'":m.match(/,/)?","+m:"")+")"):m}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
v).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(m,d,t,l,E,M,L,U){return v(m,l,E,M,L,U,t,d)});J=h+("$"==J.charAt(0)?"":"$")+J.replace(/`([0-9]+|\])/g,function(m,d){return"]"==d?"]":q[d]});for(var f=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+J+"}"),x=0;x<arguments.length-1;x++)arguments[x]=arguments[x+1];return K?f.apply(this,arguments):f}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(u,A,D,J){u=u(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});D("extend-esri")&&A.setObject("tasks.PrintParameters",u,J);return u})},"jimu/SpatialReference/srUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(u,A,D,J,K,v,r,q){var h=null,f=null,x=!1,m=u(null,function(){});
u=require.toUrl("jimu");var d=v(u+"/SpatialReference/cs.json",{handleAs:"json"}),t=v(u+"/SpatialReference/transform.json",{handleAs:"json"});m.loadResource=function(){var l=new J;if(h&&f)return l.resolve(),l;K([d,t]).then(function(E){h=E[0];f=E[1];x=!0;l.resolve()},function(E){console.error(E);x=!1;l.reject(E)});return l};m.getAllCSUnits=function(){if(x){var l=[];D.forEach(h.wkids,A.hitch(this,function(E){E=this.getCSUnit(E);-1===D.indexOf(l,E)&&l.push(E)}));return l}};m.convertUnit=function(l,E,
M){if(x)return q.convertUnit(l,E,M)};m.getUnitRate=function(l,E){if(x)return q.getUnitRate(l,E)};m.isProjectUnit=function(l){if(x)return q.isProjectUnit(l)};m.isGeographicUnit=function(l){if(x)return q.isGeographicUnit(l)};m.getGeographicUnits=function(){if(x)return q.getGeographicUnits()};m.getProjectUnits=function(){if(x)return q.getProjectUnits()};m.getCSUnit=function(l){if(x)return l=D.indexOf(h.wkids,l),h.units[l]};m.isSameSR=function(l,E){if(x)return l=this.indexOfWkid(l),E=this.indexOfWkid(E),
h.labels[l]===h.labels[E]};m.isValidWkid=function(l){if(x)return-1<this.indexOfWkid(l)};m.getSRLabel=function(l){if(x&&this.isValidWkid(l))return l=this.indexOfWkid(l),h.labels[l]};m.indexOfWkid=function(l){if(x)return D.indexOf(h.wkids,l)};m.isWebMercator=function(l){return r.prototype._isWebMercator?r.prototype._isWebMercator.apply({wkid:parseInt(l,10)},[]):(new r(parseInt(l,10))).isWebMercator()};m.standardizeWkid=function(l){return this.isWebMercator(l)?3857:parseInt(l,10)};m.isValidTfWkid=function(l){if(x)return-1<
this.indexOfTfWkid(l)};m.getTransformationLabel=function(l){if(x)return this.isValidTfWkid(l)?(l=this.indexOfTfWkid(l),f.labels[l]):""};m.indexOfTfWkid=function(l){if(x)return D.indexOf(f.tfWkids,l)};m.isGeographicCS=function(l){if(x)return this.isValidWkid(l)?(l=this.indexOfWkid(l),!h.projSR[l]):!1};m.isProjectedCS=function(l){if(x)return this.isValidWkid(l)?(l=this.indexOfWkid(l),h.projSR[l]):!1};m.getGeoCSByProj=function(l){if(x&&this.isProjectedCS(l))return l=this.indexOfWkid(l),h.spheroids[l]};
m.getSpheroidStr=function(l){if(x)return this.isGeographicCS(l)?h.labels[this.indexOfWkid(l)]:this.isProjectedCS(l)?(l=m.getGeoCSByProj(l),h.labels[this.indexOfWkid(l)]):null};m.isSameSpheroid=function(l,E){if(x)return l=this.getSpheroidStr(l),E=this.getSpheroidStr(E),l&&E&&l===E?!0:!1};return m})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),function(u,A,
D,J,K,v,r,q){return A("dijit.ProgressBar",[v,r],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:q,_indeterminateHighContrastImagePath:u.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(h){var f="rtl"==h.toLowerCase();D.toggle(this.domNode,"dijitProgressBarRtl",f);D.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&f);this.inherited(arguments)},update:function(h){J.mixin(this,h||{});h=this.internalProgress;var f=this.domNode,x=1;this.indeterminate?f.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(x=Math.min(parseFloat(this.progress)/100,1),this.progress=x*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),x=this.maximum?this.progress/this.maximum:0),f.setAttribute("aria-valuenow",this.progress));f.setAttribute("aria-labelledby",this.labelNode.id);f.setAttribute("aria-valuemin",0);f.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(x);D.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);D.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());h.style.width=100*x+"%";this.onChange()},_setValueAttr:function(h){this._set("value",
h);Infinity==h?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:h})},_setLabelAttr:function(h){this._set("label",h);this.update()},_setIndeterminateAttr:function(h){this._set("indeterminate",h);this.update()},report:function(h){return this.label?this.label:this.indeterminate?"\x26#160;":K.format(h,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"widgets/Print/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css",
"dojo/i18n!./nls/strings"],function(){})},"url:widgets/Print/templates/Print.html":'\x3cdiv class\x3d"gis_PrintDijit"\x3e\r\n    \x3cdiv class\x3d"formContainer"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"printSettingsFormDijit"\x3e\r\n            \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                \x3ctr data-dojo-attach-point\x3d"titleTr"\x3e\r\n                    \x3ctd style\x3d"width:65px;"\x3e\r\n                        ${nls.title}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-attach-point\x3d"titleNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'title\',trim:true,required:true,style:\'width:100%;\'" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.layout}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'layout\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"layoutDijit" data-dojo-attach-event\x3d"Change:onLayoutChange"/\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.format}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'format\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"formatDijit" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonActionBar jimu-align-trailing"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"advancedButtonDijit" style\x3d"display: none"\r\n            data-dojo-attach-event\x3d"onclick:showSettings"\x3e\x3cdiv class\x3d"btn-icon settingsIcon"\x3e\x3c/div\x3e${nls.settings}\x3c/div\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog" data-dojo-attach-point\x3d"settingsDialog"\r\n            style\x3d"display: none" class\x3d"gis_PrintDijit"\x3e\r\n            \x3cdiv style\x3d"width:250px;"\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapScaleExtent}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"preserveFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.preserve}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapScale" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',checked:true,value:\'true\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapScaleLabel"\x3e${nls.mapScale}\x3c/label\x3e\r\n                                \x3cbr /\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapExtent" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'false\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapExtentLabel"\x3e${nls.mapExtent}\x3c/label\x3e\r\n                            \x3c/td\x3e\r\n                            \x3ctr\x3e\r\n                                \x3ctd style\x3d"vertical-align: top; padding-top: 7px;"\x3e\r\n                                    ${nls.forceScale}:\r\n                                \x3c/td\x3e\r\n                                \x3ctd\x3e\r\n                                    \x3cdiv style\x3d"display: flex;"\x3e\r\n                                        \x3cinput type\x3d"radio" style\x3d"margin-top: 7px;" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'force\',checked:false"/\x3e\r\n                                        \x3cdiv style\x3d"display: flex; flex-direction: column;"\x3e\r\n                                            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'forcedScale\',required:false,style:\'width:100px;\'" data-dojo-attach-point\x3d"forceScaleNTB"/\x3e\r\n                                            \x3ca href\x3d"#" data-dojo-attach-event\x3d"click:getCurrentMapScale"\x3e${nls.getCurrentScale}\x3c/a\x3e\r\n                                        \x3c/div\x3e\r\n                                    \x3c/div\x3e\r\n                                \x3c/td\x3e\r\n                            \x3c/tr\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold; margin-bottom: 5px"\x3e\r\n                    \x3cspan\x3e${nls.outputSR}\x3c/span\x3e\r\n                    \x3ca href\x3d"https://developers.arcgis.com/javascript/jshelp/ref_coordsystems.html" target\x3d"blank"\x3eWKID\x3c/a\x3e\r\n                    \x3cspan\x3e:\x3c/span\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"margin-bottom: 5px"\x3e\r\n                    \x3cdiv\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"onChange:_onOutputSRChange"\r\n                            data-dojo-attach-point\x3d"wkidInput" data-dojo-props\x3d\'style:{width:"100%"}\'\r\n                            data-dojo-props\x3d"required: false"/\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"wkid-label jimu-ellipsis" data-dojo-attach-point\x3d"wkidLabel"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;" data-dojo-attach-point\x3d"labelsTitleNode"\x3e\r\n                    ${nls.labels}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"labelsFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.showLabels}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'showLabels\',value:true,checked:true" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapMetadata}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutMetadataDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"authorTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.author}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"authorNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'author\',trim:true,required:false,style:\'width:100%;\'" data-dojo-attach-point\x3d"authorTB"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"copyrightTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.copyright}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3ctextarea data-dojo-attach-point\x3d"copyrightNode" name\x3d"copyright"\r\n                                    data-dojo-type\x3d"dijit/form/SimpleTextarea"\r\n                                    style\x3d"width:100%;height:60px;resize:none;"\x3e\x3c/textarea\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"customTextElementsDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;" data-dojo-attach-point\x3d"customTextElementsTable"\x3e\r\n\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"legendTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.lncludeLegend}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'legend\',value:true,checked:true"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"scalebarTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.scaleBarUnit}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'scalebarUnit\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"scalebarUnitDijit"\x3e\r\n                                    \x3coption value\x3d"Miles" selected\x3d"selected"\x3e${nls.unitsMiles}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Kilometers"\x3e${nls.unitsKilometers}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Meters"\x3e${nls.unitsMeters}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Feet"\x3e${nls.unitsFeet}\x3c/option\x3e\r\n                                \x3c/select\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapOnlyOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapOnlyFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.width}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'width\',required:true,value:670,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.height}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'height\',required:true,value:500,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.printQualityOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapQualityFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.dpi}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'dpi\',required:true,value:96,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.forceFeatureAttributes}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"forceAttributesFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.includeFeatureAttributes}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'forceFeatureAttributes\',value:true,checked:false" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"printButtonDijit"\r\n            data-dojo-attach-event\x3d"onclick:print"\x3e\x3cdiv class\x3d"btn-icon printIcon"\x3e\x3c/div\x3e${nls.print}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- \x3chr calss\x3d"spacer"\x3e --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"printResultsNode" class\x3d"resultsContainer"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"clearActionBarNode" class\x3d"buttonActionBar"\r\n    style\x3d"display:none;padding:0;"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-event\x3d"onclick:clearResults"\x3e\r\n            \x3cdiv class\x3d"btn-icon clearIcon"\x3e\x3c/div\x3e${nls.clearList}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Print/templates/PrintResult.html":'\x3cdiv class\x3d"printResult" data-dojo-attach-point\x3d"resultNode" data-dojo-attach-event\x3d"onclick:_openPrint"\x3e\r\n  \x3ctable class\x3d"printResultTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd width\x3d"25px"\x3e\r\n        \x3cspan class\x3d"bold"\x3e${count}.\x3c/span\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd width\x3d"30px"\x3e\r\n        \x3cimg src\x3d"${icon}"\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"nameNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"progressBar" data-dojo-type\x3d"dijit/ProgressBar" data-dojo-props\x3d\'value:Infinity\'\x3e\x3c/div\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"successNode" class\x3d"bold" style\x3d"display:none;"\x3e${docName}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"errNode" style\x3d"display:none;"\x3e\r\n          \x3cspan class\x3d"bold"\x3e${nls.printError}\x3c/span\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error jimu-float-trailing"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:widgets/Print/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"printNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/Print/css/style.css":".jimu-widget-print{width: 100%; height: 100%; position: relative;}.jimu-widget-print .dijitSelect{height: 20px; width: 100%;}.gis_PrintDijit {width: 100%;}.gis_PrintDijit .printResult {height: 28px; margin-bottom: -1px; width: 100%;}.gis_PrintDijit .printResult .printResultTable {width: 100%;}.gis_PrintDijit .printResult .bold {font-weight: bold;}.gis_PrintDijit .printResultError {font-weight: bold; color: red; cursor: help;}.gis_PrintDijit .printResultHover table:hover {background-color: #D4E7F8; cursor: pointer;}.gis_PrintDijit .buttonActionBar {padding: 3px 0px 2px 0px; width: 100%;}.gis_PrintDijit .formContainer {margin-bottom: -1px; width: 100%;}.gis_PrintDijit .resultsContainer {width: 100%; margin-top: 10px;}.gis_PrintDijit .btn-icon {width: 16px; height: 16px; display: inline-block; vertical-align: text-top; margin-right: 10px;}.jimu-rtl .gis_PrintDijit .btn-icon {margin-right: auto; margin-left: 10px;}.gis_PrintDijit .printIcon {background-image: url(../images/print.png);}.gis_PrintDijit .clearIcon {background-image: url(../images/clear.png);}.gis_PrintDijit .settingsIcon {background-image: url(../images/settings.png); width: 16px; height: 16px;}.gis_PrintDijit .dijitArrowButtonContainer{width: 17px;}.gis_PrintDijit .wkid-label{font-size: 12px; font-style: italic; color: #a0acbf; width: 100%;}",
"*now":function(u){u(['dojo/i18n!*preload*widgets/Print/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidget jimu/portalUtils dojo/_base/lang dojo/Deferred jimu/dijit/Message jimu/dijit/LoadingIndicator ./Print esri/request jimu/portalUrlUtils".split(" "),function(u,A,D,J,K,v,r,q,h,f){return u([A],{baseClass:"jimu-widget-print",name:"Print",className:"esri.widgets.Print",_portalPrintTaskURL:null,postCreate:function(){this.inherited(arguments);this.shelter=new r({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup()},startup:function(){this.inherited(arguments);
this.shelter.show();this._initPrinter()},destroy:function(){this.print&&this.print.closeSettings();this.inherited(arguments)},onClose:function(){this.print&&this.print.closeSettings()},_initPrinter:function(){this._getPrintTaskURL(this.appConfig.portalUrl).then(J.hitch(this,function(x){this.shelter.show();this.isAsync(x).then(J.hitch(this,function(m){this.print=new q({map:this.map,appConfig:this.appConfig,printTaskURL:x,defaultAuthor:this.config.defaultAuthor,defaultCopyright:this.config.defaultCopyright,
copyrightEditable:!1!==this.config.copyrightEditable,defaultTitle:this.config.defaultTitle,defaultFormat:this.config.defaultFormat,defaultLayout:this.config.defaultLayout,nls:this.nls,async:m});this.print.placeAt(this.printNode);this.print.startup()}),J.hitch(this,function(m){new v({message:m.message})})).always(J.hitch(this,function(){this.shelter.hide()}))}),J.hitch(this,function(x){new v({message:x});console.error(x);this.shelter.hide()}))},_getPrintTaskURL:function(x){var m=new K;if(this.config&&
this.config.serviceURL)return m.resolve(this.config.serviceURL),m;D.getPortalSelfInfo(x).then(J.hitch(this,function(d){(d=d&&d.helperServices&&d.helperServices.printTask&&d.helperServices.printTask.url)?m.resolve(d):m.reject("error")}),J.hitch(this,function(d){new v({message:this.nls.portalConnectionError});m.reject("error");console.error(d)}));return m},isAsync:function(x){var m=new K,d=f.setHttpProtocol(x),t=f.getNewPrintUrl(this.appConfig.portalUrl);d===t||/sharing\/tools\/newPrint$/.test(d)?m.resolve(!1):
h({url:x,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4,load:J.hitch(this,function(l){"esriExecutionTypeAsynchronous"===l.executionType?m.resolve(!0):m.resolve(!1)}),error:J.hitch(this,function(l){m.reject(l)})});return m},onSignIn:function(x){x=x||{};x.userId&&this.print&&this.print.updateAuthor(x.userId)}})});